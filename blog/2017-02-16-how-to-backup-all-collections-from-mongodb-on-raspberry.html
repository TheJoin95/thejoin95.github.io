<!DOCTYPE html><html lang="en" amp=""><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="icon" href="/images/icon.png"><meta name="theme-color" content="#3b4252"><title>How to backup all collections from mongodb (raspberry) - Miki Lombardi</title><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Red+Hat+Display&amp;display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tailwindcss/typography@0.2.x/dist/typography.min.css"><script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script><script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script><link href="/css/about.36c9af4f.css" rel="prefetch"><link href="/js/about.f984a725.js" rel="prefetch"><link href="/js/chunk-2d0cf6d6.e6f6d766.js" rel="prefetch"><link href="/js/chunk-2d0d6391.331694ff.js" rel="prefetch"><link href="/js/chunk-2d0d69b1.3c6cac3b.js" rel="prefetch"><link href="/js/chunk-2d0de2f3.2b4689c6.js" rel="prefetch"><link href="/js/chunk-2d0de79d.4d1d5af4.js" rel="prefetch"><link href="/js/chunk-2d0e4833.40004825.js" rel="prefetch"><link href="/js/chunk-2d0e599e.ac24a02d.js" rel="prefetch"><link href="/js/chunk-2d208114.3f138e4b.js" rel="prefetch"><link href="/js/chunk-2d2109de.141ca7ff.js" rel="prefetch"><link href="/js/chunk-2d213737.8cb5b0c4.js" rel="prefetch"><link href="/js/chunk-2d21d51b.9549b08e.js" rel="prefetch"><link href="/js/chunk-2d21eace.bb4c5b26.js" rel="prefetch"><link href="/js/chunk-2d221839.3fed34d2.js" rel="prefetch"><link href="/js/chunk-2d2248e4.2df9a3a6.js" rel="prefetch"><link href="/js/chunk-2d230282.de43d66e.js" rel="prefetch"><link href="/js/chunk-2d230644.a842f60a.js" rel="prefetch"><link href="/css/app.a4a22bc3.css" rel="preload" as="style"><link href="/js/app.05cc152f.js" rel="preload" as="script"><link href="/js/chunk-vendors.f00deeb5.js" rel="preload" as="script"><link href="/css/app.a4a22bc3.css" rel="stylesheet"><link href="https://www.googletagmanager.com" rel="preconnect"><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-98330359-1&amp;l=dataLayer" charset="utf-8"></script><script charset="utf-8" src="/js/chunk-2d2248e4.2df9a3a6.js"></script><meta data-vue-meta="1" data-vmid="description" name="description" content="How to backup all collections and database from mongodb istance hosted in server (in this case on raspberry)"><meta data-vue-meta="1" data-vmid="og:title" name="og:title" content="How to backup all collections from mongodb (raspberry)"><meta data-vue-meta="1" data-vmid="og:type" name="og:type" content="article"><meta data-vue-meta="1" data-vmid="og:url" name="og:url" content="http://localhost:8000/blog/2017-02-16-how-to-backup-all-collections-from-mongodb-on-raspberry"><meta data-vue-meta="1" data-vmid="og:site_name" name="og:site_name" content="localhost"><meta data-vue-meta="1" data-vmid="og:description" name="og:description" content="How to backup all collections and database from mongodb istance hosted in server (in this case on raspberry)"><meta data-vue-meta="1" data-vmid="og:image" name="og:image" content="https://source.unsplash.com/zDxlNcdUzxk/960x680"><meta data-vue-meta="1" data-vmid="twitter:widgets:csp" name="twitter:widgets:csp" content="on"><meta data-vue-meta="1" data-vmid="twitter:card" name="twitter:card" content="https://source.unsplash.com/zDxlNcdUzxk/960x680"><meta data-vue-meta="1" data-vmid="twitter:image" name="twitter:image" content="https://source.unsplash.com/zDxlNcdUzxk/960x680"><meta data-vue-meta="1" data-vmid="twitter:site" name="twitter:site" content="@thejoin95"><meta data-vue-meta="1" data-vmid="twitter:creator" name="twitter:creator" content="@thejoin95"><meta data-vue-meta="1" data-vmid="twitter:domain" name="twitter:domain" content="localhost"><meta data-vue-meta="1" data-vmid="twitter:title" name="twitter:title" content="How to backup all collections from mongodb (raspberry)"><meta data-vue-meta="1" data-vmid="twitter:description" name="twitter:description" content="How to backup all collections and database from mongodb istance hosted in server (in this case on raspberry)"><script data-vue-meta="1" type="application/ld+json">{"@context":"https://schema.org","@type":"TechArticle","author":"Miki Lombardi","name":"How to backup all collections from mongodb (raspberry)","articleBody":" <h1 id=\"how-to-backup-all-collections-from-mongodb-raspberry\">How to backup all collections from mongodb (raspberry)</h1> <div class=\"mx-auto\"> <img class=\"max-w-full\" src=\"https://source.unsplash.com/zDxlNcdUzxk/960x680\"/> </div> <p>After some problems with my raspberry power supply and mongo 3.0 I decided to make a dayly backup. Sometimes happened that, after an unexpected shutdown (for an high load average and not too much power), some mongo collections may be broken. If it&#39;ll happen without any backup, the only words you can say are: I&#39;m fuck.</p> <p>Yeah, I know.. if you install mongo on a 32bit system with only 1GB ram (Raspberry Pi 3), you are probabily (like me) mad. But! It&#39;s useful for some testing or a micro-system.</p> <h2 id=\"so-the-solution\">So.. the solution</h2> <p>One of the idea that I&#39;ve got is make a dayly backup. I use 3.0 mongo version, but it will be ok for &gt; 3.0 version. <strong>NOTE: you need to install mongotools.</strong></p> <p>Here is the code:</p> <p>{% highlight bash %}</p> <p>#!/bin/sh</p> <p>APP_NAME=&quot;raspberry&quot;</p> <p>MONGO_HOST=&quot;127.0.0.1&quot; MONGO_PORT=&quot;27017&quot; TIMESTAMP=<code>date +%F-%H%M</code> MONGODUMP_PATH=&quot;/usr/bin/mongodump&quot; BACKUPS_DIR=&quot;/home/pi/dump&quot; BACKUP_NAME=&quot;$APP_NAME-$TIMESTAMP&quot;</p> <p>$MONGODUMP_PATH</p> <p>mkdir -p $BACKUPS_DIR mv dump_file $BACKUP_NAME tar -zcvf $BACKUPS_DIR/$BACKUP_NAME.tgz $BACKUP_NAME rm -rf $BACKUP_NAME</p> <p>{% endhighlight %}</p> <p>The workflow is:</p> <ul> <li>Launch mongodump in the directory of the script</li> <li>Create the directory (if not exist) for the backup&#39;s files</li> <li>Move &quot;dump_file&quot; (created by mongodump cmd) to our backup name file</li> <li>make a tar (for storage saving) of the file and then remove the old one</li> </ul> <p>You need to program this script in your crontab like this: <code>30 3 * * * root /bin/bash /home/pi/mongo.sh &gt; /tmp/mongodump.log 2&gt;&amp;1 &amp;</code></p> <p>Note: for restore the collections you need to tar the file then to mongorestore</p> ","abstract":"How to backup all collections and database from mongodb istance hosted in server (in this case on raspberry)"}</script></head><body><noscript><strong>We're sorry but portfolio doesn't work properly without JavaScript enabled. Please enable it to continue.</strong></noscript><div id="app"><div class="lettering content fixed"><div class="slideshow"><div class="slide slide--current"><svg class="shapes" width="800px" height="600px" viewbox="0 0 800 600"><rect width="19.75484375" height="47.52" x="254.771015625" y="267.24" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0.229523; transform-origin: 264.648px 291px; transform: translateX(-16.9767px) translateY(135.813px) scale(0.299918) rotate(-0.998628deg);"></rect><polygon points="243.984375 345, 264.6484375 303.671875, 285.3125 345" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0.318999; transform-origin: 264.648px 291px; transform: translateX(125.533px) translateY(192.285px) scale(0.310852) rotate(3.98518deg);"></polygon><circle r="20.6640625" cx="264.6484375" cy="291" fill="none" stroke-width="10" stroke="red" style="opacity: 0.423169; transform-origin: 264.648px 291px; transform: translateX(2.97395px) translateY(90.2099px) scale(0.599132) rotate(0.991317deg);"></circle><rect width="20.0028125" height="18.360000000000003" x="254.64703125" y="281.82" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.542033; transform-origin: 264.648px 291px; transform: translateX(-53.0116px) translateY(-97.188px) scale(0.367071) rotate(14.7254deg);"></rect><circle r="20.6640625" cx="264.6484375" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.67559; transform-origin: 264.648px 291px; transform: translateX(75.2289px) translateY(-157.209px) scale(0.402539) rotate(-8.68025deg);"></circle><circle r="20.6640625" cx="264.6484375" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.823841; transform-origin: 264.648px 291px; transform: translateX(-178.671px) translateY(32.7407px) scale(0.459354) rotate(-2.80635deg);"></circle><rect width="15.167421875" height="51.192" x="257.0647265625" y="265.404" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.986787; transform-origin: 264.648px 291px; transform: translateX(83.5557px) translateY(-104.889px) scale(0.542223) rotate(-6.22223deg);"></rect><polygon points="243.984375 345, 264.6484375 303.671875, 285.3125 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 264.648px 291px; transform: translateX(80.084px) translateY(141.373px) scale(0.323656) rotate(9.8062deg);"></polygon><polygon points="243.984375 345, 264.6484375 303.671875, 285.3125 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 264.648px 291px; transform: translateX(26.2873px) translateY(-99.4655px) scale(0.491581) rotate(6.39421deg);"></polygon><polygon points="243.984375 345, 264.6484375 303.671875, 285.3125 345" fill="none" stroke-width="10" stroke="#fff" style="opacity: 1; transform-origin: 264.648px 291px; transform: translateX(87.3278px) translateY(-35.0424px) scale(0.314438) rotate(-0.556228deg);"></polygon><polygon points="285.3125 345, 311.9921875 291.640625, 338.671875 345" fill="none" stroke-width="10" stroke="red" style="opacity: 0.329843; transform-origin: 311.992px 291px; transform: translateX(138.43px) translateY(94.6107px) scale(0.300205) rotate(13.9426deg);"></polygon><rect width="14.033515625000001" height="38.556" x="304.9754296875" y="271.722" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.435645; transform-origin: 311.992px 291px; transform: translateX(-46.5546px) translateY(-174.332px) scale(0.599052) rotate(0.990523deg);"></rect><rect width="19.74296875" height="25.811999999999998" x="302.120703125" y="278.094" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0.556141; transform-origin: 311.992px 291px; transform: translateX(-33.3276px) translateY(-138.212px) scale(0.39) rotate(5.88134deg);"></rect><rect width="17.2884375" height="38.879999999999995" x="303.34796875" y="271.56" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0.69133; transform-origin: 311.992px 291px; transform: translateX(6.73345px) translateY(191.422px) scale(0.492285) rotate(-7.69537deg);"></rect><rect width="8.00390625" height="28.080000000000002" x="307.990234375" y="276.96" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.841214; transform-origin: 311.992px 291px; transform: translateX(170.422px) translateY(185.322px) scale(0.355189) rotate(-14.9002deg);"></rect><rect width="2.721328125" height="19.224" x="310.6315234375" y="281.388" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 311.992px 291px; transform: translateX(76.7624px) translateY(83.821px) scale(0.527052) rotate(-14.1172deg);"></rect><polygon points="285.3125 345, 311.9921875 291.640625, 338.671875 345" fill="none" stroke-width="10" stroke="red" style="opacity: 1; transform-origin: 311.992px 291px; transform: translateX(-104.944px) translateY(79.1118px) scale(0.437235) rotate(7.26537deg);"></polygon><rect width="25.71921875" height="7.776" x="299.132578125" y="287.112" fill="none" stroke-width="10" stroke="red" style="opacity: 1; transform-origin: 311.992px 291px; transform: translateX(-29.9254px) translateY(-139.188px) scale(0.587838) rotate(-10.4391deg);"></rect><rect width="4.5355468750000005" height="43.632000000000005" x="309.7244140625" y="269.18399999999997" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 311.992px 291px; transform: translateX(75.5083px) translateY(-58.9072px) scale(0.44683) rotate(4.28416deg);"></rect><circle r="26.6796875" cx="311.9921875" cy="291" fill="none" stroke-width="10" stroke="#fff" style="opacity: 1; transform-origin: 311.992px 291px; transform: translateX(54.5643px) translateY(-26.3521px) scale(0.405198) rotate(-1.55012deg);"></circle><polygon points="338.671875 345, 360.671875 301, 382.671875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.660003; transform-origin: 360.672px 291px; transform: translateX(17.4039px) translateY(-5.8013px) scale(0.212649) rotate(0deg);"></polygon><rect width="3.388" height="17.064" x="358.977875" y="282.468" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.80662; transform-origin: 360.672px 291px; transform: translateX(34.7587px) translateY(-101.458px) scale(0.577885) rotate(14.0914deg);"></rect><rect width="10.736" height="45.684" x="355.303875" y="268.158" fill="none" stroke-width="10" stroke="red" style="opacity: 0.96793; transform-origin: 360.672px 291px; transform: translateX(-147.701px) translateY(-162.918px) scale(0.518467) rotate(12.5322deg);"></rect><rect width="16.632" height="49.896" x="352.355875" y="266.052" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 360.672px 291px; transform: translateX(-13.2271px) translateY(-69.442px) scale(0.531473) rotate(8.26691deg);"></rect><rect width="14.3" height="33.588" x="353.521875" y="274.206" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 360.672px 291px; transform: translateX(-12.3154px) translateY(110.839px) scale(0.461421) rotate(0deg);"></rect><rect width="10.559999999999999" height="31.104" x="355.391875" y="275.448" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 360.672px 291px; transform: translateX(80.6675px) translateY(70.296px) scale(0.327141) rotate(-2.88098deg);"></rect><rect width="14.168000000000001" height="44.064" x="353.587875" y="268.968" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 360.672px 291px; transform: translateX(-49.5083px) translateY(-67.8448px) scale(0.393686) rotate(-2.93383deg);"></rect><polygon points="338.671875 345, 360.671875 301, 382.671875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 360.672px 291px; transform: translateX(6.72362px) translateY(-15.4566px) scale(0.243911) rotate(-0.850113deg);"></polygon><circle r="22" cx="360.671875" cy="291" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 360.672px 291px; transform: translateX(0px) translateY(0px) scale(0.34) rotate(0deg);"></circle><rect width="18.084" height="11.772" x="351.629875" y="285.114" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 360.672px 291px; transform: translateX(0px) translateY(0px) scale(0.56) rotate(0deg);"></rect><rect width="7.596" height="11.556" x="396.873875" y="285.222" fill="none" stroke-width="10" stroke="red" style="opacity: 0.912516; transform-origin: 400.672px 291px; transform: translateX(128.62px) translateY(-39.2245px) scale(0.225268) rotate(-11.8586deg);"></rect><rect width="14.076" height="40.176" x="393.633875" y="270.912" fill="none" stroke-width="10" stroke="red" style="opacity: 1; transform-origin: 400.672px 291px; transform: translateX(-57.9869px) translateY(115.974px) scale(0.400615) rotate(-0.852749deg);"></rect><circle r="18" cx="400.671875" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 400.672px 291px; transform: translateX(-10.6817px) translateY(-98.4242px) scale(0.317111) rotate(-7.62978deg);"></circle><circle r="18" cx="400.671875" cy="291" fill="none" stroke-width="10" stroke="red" style="opacity: 1; transform-origin: 400.672px 291px; transform: translateX(-83.3716px) translateY(-12.0005px) scale(0.465788) rotate(-1.26321deg);"></circle><rect width="11.916" height="40.716" x="394.713875" y="270.642" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 400.672px 291px; transform: translateX(-10.6668px) translateY(31.5559px) scale(0.342222) rotate(-1.77779deg);"></rect><polygon points="382.671875 345, 400.671875 309, 418.671875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 400.672px 291px; transform: translateX(15.455px) translateY(7.35953px) scale(0.333357) rotate(-1.10393deg);"></polygon><polygon points="382.671875 345, 400.671875 309, 418.671875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 400.672px 291px; transform: translateX(0px) translateY(0px) scale(0.23) rotate(0deg);"></polygon><rect width="11.232" height="44.928" x="395.055875" y="268.536" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 400.672px 291px; transform: translateX(0px) translateY(0px) scale(0.45) rotate(0deg);"></rect><circle r="18" cx="400.671875" cy="291" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 400.672px 291px; transform: translateX(0px) translateY(0px) scale(0.33) rotate(0deg);"></circle><circle r="18" cx="400.671875" cy="291" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 400.672px 291px; transform: translateX(0px) translateY(0px) scale(0.3) rotate(0deg);"></circle><polygon points="418.671875 345, 448.6640625 285.015625, 478.65625 345" fill="none" stroke-width="10" stroke="red" style="opacity: 1; transform-origin: 448.664px 291px; transform: translateX(96.6571px) translateY(142.403px) scale(0.483298) rotate(2.95136deg);"></polygon><rect width="23.63384375" height="48.384" x="436.847140625" y="266.808" fill="none" stroke-width="10" stroke="red" style="opacity: 1; transform-origin: 448.664px 291px; transform: translateX(-52.9915px) translateY(-1.19082px) scale(0.374807) rotate(-1.78623deg);"></rect><rect width="10.19734375" height="40.5" x="443.565390625" y="270.75" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 448.664px 291px; transform: translateX(-48.0208px) translateY(70.0632px) scale(0.517872) rotate(-3.14891deg);"></rect><polygon points="418.671875 345, 448.6640625 285.015625, 478.65625 345" fill="none" stroke-width="10" stroke="red" style="opacity: 1; transform-origin: 448.664px 291px; transform: translateX(11.4114px) translateY(-10.3844px) scale(0.295105) rotate(1.25526deg);"></polygon><polygon points="418.671875 345, 448.6640625 285.015625, 478.65625 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 448.664px 291px; transform: translateX(0px) translateY(0px) scale(0.44) rotate(0deg);"></polygon><rect width="9.23759375" height="6.912" x="444.045265625" y="287.544" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 448.664px 291px; transform: translateX(0px) translateY(0px) scale(0.41) rotate(0deg);"></rect><polygon points="418.671875 345, 448.6640625 285.015625, 478.65625 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 448.664px 291px; transform: translateX(0px) translateY(0px) scale(0.21) rotate(0deg);"></polygon><polygon points="418.671875 345, 448.6640625 285.015625, 478.65625 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 448.664px 291px; transform: translateX(0px) translateY(0px) scale(0.2) rotate(0deg);"></polygon><rect width="8.097890625" height="33.48" x="444.6151171875" y="274.26" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 448.664px 291px; transform: translateX(0px) translateY(0px) scale(0.34) rotate(0deg);"></rect><circle r="29.9921875" cx="448.6640625" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 448.664px 291px; transform: translateX(0px) translateY(0px) scale(0.43) rotate(0deg);"></circle><circle r="10.015625" cx="488.671875" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 488.672px 291px; transform: translateX(-41.692px) translateY(13.8973px) scale(0.476104) rotate(1.01688deg);"></circle><polygon points="478.65625 345, 488.671875 324.96875, 498.6875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 488.672px 291px; transform: translateX(6.37045px) translateY(2.67402px) scale(0.269214) rotate(0.235943deg);"></polygon><rect width="1.1618125000000001" height="51.3" x="488.09096875" y="265.35" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 488.672px 291px; transform: translateX(0px) translateY(0px) scale(0.3) rotate(0deg);"></rect><rect width="4.8475624999999996" height="11.664" x="486.24809375" y="285.168" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 488.672px 291px; transform: translateX(0px) translateY(0px) scale(0.43) rotate(0deg);"></rect><rect width="9.394656249999999" height="23.976" x="483.974546875" y="279.012" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 488.672px 291px; transform: translateX(0px) translateY(0px) scale(0.32) rotate(0deg);"></rect><rect width="6.5301875" height="45.792" x="485.40678125" y="268.104" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 488.672px 291px; transform: translateX(0px) translateY(0px) scale(0.42) rotate(0deg);"></rect><rect width="1.041625" height="15.767999999999999" x="488.1510625" y="283.116" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 488.672px 291px; transform: translateX(0px) translateY(0px) scale(0.43) rotate(0deg);"></rect><polygon points="478.65625 345, 488.671875 324.96875, 498.6875 345" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 488.672px 291px; transform: translateX(0px) translateY(0px) scale(0.38) rotate(0deg);"></polygon><polygon points="478.65625 345, 488.671875 324.96875, 498.6875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 488.672px 291px; transform: translateX(0px) translateY(0px) scale(0.5) rotate(0deg);"></polygon><polygon points="478.65625 345, 488.671875 324.96875, 498.6875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 488.672px 291px; transform: translateX(0px) translateY(0px) scale(0.52) rotate(0deg);"></polygon><polygon points="498.6875 345, 527.34375 287.6875, 556 345" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.55) rotate(0deg);"></polygon><rect width="8.94075" height="38.123999999999995" x="522.873375" y="271.938" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.55) rotate(0deg);"></rect><rect width="27.051499999999997" height="5.94" x="513.818" y="288.03" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.48) rotate(0deg);"></rect><polygon points="498.6875 345, 527.34375 287.6875, 556 345" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.22) rotate(0deg);"></polygon><polygon points="498.6875 345, 527.34375 287.6875, 556 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.34) rotate(0deg);"></polygon><rect width="25.1601875" height="25.164" x="514.76365625" y="278.418" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.34) rotate(0deg);"></rect><polygon points="498.6875 345, 527.34375 287.6875, 556 345" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.39) rotate(0deg);"></polygon><rect width="15.703625" height="20.196" x="519.4919375" y="280.902" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.26) rotate(0deg);"></rect><polygon points="498.6875 345, 527.34375 287.6875, 556 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.4) rotate(0deg);"></polygon><rect width="14.843937500000001" height="41.58" x="519.92178125" y="270.21" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.59) rotate(0deg);"></rect></svg><h2 class="word word--1" aria-label="thejoin"><span class="char1" aria-hidden="true" style="opacity: 1; transform: translateY(0px);">t</span><span class="char2" aria-hidden="true" style="opacity: 1; transform: translateY(0px);">h</span><span class="char3" aria-hidden="true" style="opacity: 1; transform: translateY(0.000191645px);">e</span><span class="char4" aria-hidden="true" style="opacity: 1; transform: translateY(-0.0614288px);">j</span><span class="char5" aria-hidden="true" style="opacity: 1; transform: translateY(1.0874px);">o</span><span class="char6" aria-hidden="true" style="opacity: 1; transform: translateY(-8.44057px);">i</span><span class="char7" aria-hidden="true" style="opacity: 1; transform: translateY(36.1474px);">n</span></h2></div></div></div><section class="navigation relative"><div class="navigation-header fixed w-full"><div class="hidden md:block absolute say-hi tracking-wider"><a href="/" class="router-link-active"><img alt="Miki go to Home" src="/images/icon.png" class="mr-1 align-top inline-block w-6 m-w-full"></a><div class="hidden-tooltip inline-block"><span class="tooltip rounded shadow-lg p-1 bg-gray-600 text-grey-500 -mt-8"> Email address copied </span><a href="#">Say Hi.</a></div></div><div class="absolute hamburger cursor-pointer p-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-8"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg></div></div><div class="navigation-footer fixed w-full"><div class="hidden md:block absolute whoami tracking-wider"><a href="/whoami" class="">WhoAmI</a></div><div class="hidden md:block absolute writing tracking-wider"><a href="/blog" class="router-link-active">Writing</a></div></div><div class="hidden shadow md:shadow-2xl w-full md:w-1/3 h-full fixed off-canvas-menu z-10 p-5"><div class="close-header w-full border-opacity-50"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="inline w-12 cursor-pointer"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg><span class="text-4xl align-middle cursor-pointer">Close</span></div><div class="mb-5 md:mb-10 pb-3 md:pb-5 mobile-content absolute bottom-0 w-full text-3xl"><ul><li class="cursor-pointer pb-1"><a href="/" class="block router-link-active">~</a></li><li class="cursor-pointer py-1"><a href="/whoami" class="block">WhoAmI</a></li><li class="cursor-pointer py-1"><a href="/blog" class="block router-link-active">Writing</a></li><li class="cursor-pointer py-1 social-li"><span class="cursor-pointer">Social</span><ul class="social-box align-middle leading-none"><li class="inline-block pr-1"><a href="https://github.com/thejoin95" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="github-icon w-6"><path fill="#FFFFFF" d="M10.015,9.949c0,0-0.01,0-0.015,0H9.985c-1.191,0-2.24-0.303-2.861,0.268  c-0.371,0.342-0.527,0.754-0.527,1.197c0,1.852,1.483,2.08,3.389,2.08h0.029c1.905,0,3.389-0.229,3.389-2.08  c0-0.443-0.156-0.856-0.527-1.197C12.255,9.646,11.206,9.949,10.015,9.949z M8.393,12.48c-0.363,0-0.656-0.408-0.656-0.91  s0.293-0.908,0.656-0.908S9.05,11.068,9.05,11.57C9.051,12.072,8.757,12.48,8.393,12.48z M11.606,12.48  c-0.363,0-0.657-0.408-0.657-0.91s0.294-0.908,0.657-0.908c0.362,0,0.656,0.406,0.656,0.908  C12.263,12.072,11.969,12.48,11.606,12.48z M10,0.4c-5.302,0-9.6,4.298-9.6,9.6s4.298,9.6,9.6,9.6s9.6-4.298,9.6-9.6  S15.302,0.4,10,0.4z M10.876,13.939c-0.172,0-0.514,0-0.876,0.002c-0.362-0.002-0.704-0.002-0.876-0.002  c-0.76,0-3.772-0.059-3.772-3.689c0-0.834,0.286-1.445,0.755-1.955c-0.074-0.184-0.078-1.232,0.32-2.236c0,0,0.916,0.1,2.301,1.051  C9.017,7.029,9.509,6.988,10,6.988s0.982,0.041,1.273,0.121c1.385-0.951,2.301-1.051,2.301-1.051  c0.398,1.004,0.395,2.053,0.32,2.236c0.469,0.51,0.755,1.121,0.755,1.955C14.648,13.881,11.636,13.939,10.876,13.939z"></path></svg></a></li><li class="inline-block px-1"><a href="https://www.facebook.com/mikistorm/" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="fb-icon w-6"><path fill="#FFFFFF" d="M10,0.4c-5.302,0-9.6,4.298-9.6,9.6s4.298,9.6,9.6,9.6s9.6-4.298,9.6-9.6S15.302,0.4,10,0.4z M12.274,7.034  h-1.443c-0.171,0-0.361,0.225-0.361,0.524V8.6h1.805l-0.273,1.486H10.47v4.461H8.767v-4.461H7.222V8.6h1.545V7.726  c0-1.254,0.87-2.273,2.064-2.273h1.443V7.034z"></path></svg></a></li><li class="inline-block px-1"><a href="https://instagram.com/thejoin95" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="ig-icon w-6"><path fill="#FFFFFF" d="M13.89777,7.05115a1.65591,1.65591,0,0,0-.94891-0.94891,2.76589,2.76589,0,0,0-.92841-0.17218C11.49316,5.906,11.33508,5.90094,10,5.90094S8.50684,5.906,7.97955,5.93005a2.76589,2.76589,0,0,0-.92841.17218,1.65591,1.65591,0,0,0-.94891.94891,2.76589,2.76589,0,0,0-.17218.92841C5.906,8.50684,5.90094,8.665,5.90094,10s0.00507,1.49316.02911,2.02045a2.76553,2.76553,0,0,0,.17218.92841,1.65591,1.65591,0,0,0,.94891.94891,2.76589,2.76589,0,0,0,.92841.17218c0.52716,0.024.6853,0.02911,2.02045,0.02911s1.49329-.00507,2.02045-0.02911a2.76589,2.76589,0,0,0,.92841-0.17218,1.65591,1.65591,0,0,0,.94891-0.94891,2.76553,2.76553,0,0,0,.17218-0.92841c0.024-.52728.02911-0.68536,0.02911-2.02045S14.094,8.50684,14.06995,7.97955A2.76589,2.76589,0,0,0,13.89777,7.05115ZM10,12.56757A2.56757,2.56757,0,1,1,12.56757,10,2.56756,2.56756,0,0,1,10,12.56757ZM12.669,7.931a0.6,0.6,0,1,1,.6-0.6A0.6,0.6,0,0,1,12.669,7.931ZM11.66669,10A1.66669,1.66669,0,1,1,10,8.33331,1.66671,1.66671,0,0,1,11.66669,10ZM10,0.4A9.6,9.6,0,1,0,19.6,10,9.59995,9.59995,0,0,0,10,.4Zm4.96991,11.6615a3.67039,3.67039,0,0,1-.23242,1.21368,2.55612,2.55612,0,0,1-1.46228,1.46228,3.67039,3.67039,0,0,1-1.21368.23242C11.5282,14.99426,11.35791,15,10,15s-1.5282-.00574-2.06152-0.03009a3.67039,3.67039,0,0,1-1.21368-.23242,2.55612,2.55612,0,0,1-1.46228-1.46228,3.67039,3.67039,0,0,1-.23242-1.21368C5.00574,11.5282,5,11.35791,5,10s0.00574-1.5282.03009-2.06152a3.67039,3.67039,0,0,1,.23242-1.21368A2.55612,2.55612,0,0,1,6.72479,5.26251a3.67039,3.67039,0,0,1,1.21368-.23242C8.4718,5.00574,8.64209,5,10,5s1.5282,0.00574,2.06152.03009a3.67039,3.67039,0,0,1,1.21368.23242,2.55612,2.55612,0,0,1,1.46228,1.46228,3.67039,3.67039,0,0,1,.23242,1.21368C14.99426,8.4718,15,8.64209,15,10S14.99426,11.5282,14.96991,12.06152Z"></path></svg></a></li><li class="inline-block px-1"><a href="https://www.linkedin.com/in/miki-lombardi/" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="ld-icon w-6"><path fill="#FFFFFF" d="M10,0.4c-5.302,0-9.6,4.298-9.6,9.6s4.298,9.6,9.6,9.6s9.6-4.298,9.6-9.6S15.302,0.4,10,0.4z M7.65,13.979  H5.706V7.723H7.65V13.979z M6.666,6.955c-0.614,0-1.011-0.435-1.011-0.973c0-0.549,0.409-0.971,1.036-0.971s1.011,0.422,1.023,0.971  C7.714,6.52,7.318,6.955,6.666,6.955z M14.75,13.979h-1.944v-3.467c0-0.807-0.282-1.355-0.985-1.355  c-0.537,0-0.856,0.371-0.997,0.728c-0.052,0.127-0.065,0.307-0.065,0.486v3.607H8.814v-4.26c0-0.781-0.025-1.434-0.051-1.996h1.689  l0.089,0.869h0.039c0.256-0.408,0.883-1.01,1.932-1.01c1.279,0,2.238,0.857,2.238,2.699V13.979z"></path></svg></a></li><li class="inline-block px-1"><a href="https://medium.com/@thejoin95" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="md-icon w-6"><path fill="#FFFFFF" d="M10,0.3999634c-5.3019409,0-9.5999756,4.2980957-9.5999756,9.6000366S4.6980591,19.5999756,10,19.5999756  S19.5999756,15.3019409,19.5999756,10S15.3019409,0.3999634,10,0.3999634z M14.2000122,7.666687h-0.1165771  c0,0-0.3500977,0-0.3500977,0.3500977c0,0.3500366,0,3.9666748,0,3.9666748s0,0.3497925,0.3500977,0.3497925h0.1165771v0.9333496  h-2.7999878V12.333252h0.4666138V7.9933472h-0.0466309l-1.4301147,5.2732544H9.1304321L7.7133179,7.9933472H7.666687v4.3399048  h0.4666748v0.9333496h-2.333374V12.333252h0.1165771c0,0,0.3500977,0,0.3500977-0.3500366s0-3.9667358,0-3.9667358  s0-0.3497925-0.3500977-0.3497925H5.7999878V6.7333984H8.895874l1.0858765,4.0408325h0.0357666l1.0959473-4.0408325h3.0865479  V7.666687z"></path></svg></a></li><li class="inline-block px-1"><a href="https://twitter.com/thejoin95" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="tw-icon w-6"><path fill="#FFFFFF" d="M10,0.4c-5.302,0-9.6,4.298-9.6,9.6s4.298,9.6,9.6,9.6s9.6-4.298,9.6-9.6S15.302,0.4,10,0.4z M13.905,8.264  c0.004,0.082,0.005,0.164,0.005,0.244c0,2.5-1.901,5.381-5.379,5.381c-1.068,0-2.062-0.312-2.898-0.85  c0.147,0.018,0.298,0.025,0.451,0.025c0.886,0,1.701-0.301,2.348-0.809c-0.827-0.016-1.525-0.562-1.766-1.312  c0.115,0.021,0.233,0.033,0.355,0.033c0.172,0,0.34-0.023,0.498-0.066c-0.865-0.174-1.517-0.938-1.517-1.854V9.033  C6.257,9.174,6.549,9.26,6.859,9.27C6.351,8.93,6.018,8.352,6.018,7.695c0-0.346,0.093-0.672,0.256-0.951  c0.933,1.144,2.325,1.896,3.897,1.977c-0.033-0.139-0.049-0.283-0.049-0.432c0-1.043,0.846-1.891,1.891-1.891  c0.543,0,1.035,0.23,1.38,0.598c0.431-0.086,0.835-0.242,1.2-0.459c-0.141,0.441-0.44,0.812-0.831,1.047  c0.383-0.047,0.747-0.148,1.086-0.299C14.595,7.664,14.274,7.998,13.905,8.264z"></path></svg></a></li><li class="inline-block px-1"><a href="https://www.youtube.com/channel/UC1QLLgrGrPmlaFhS0orykCA" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="yt-icon w-6"><path fill="#FFFFFF" d="M11.603,9.833L9.357,8.785C9.161,8.694,9,8.796,9,9.013v1.974c0,0.217,0.161,0.319,0.357,0.228l2.245-1.048  C11.799,10.075,11.799,9.925,11.603,9.833z M10,0.4c-5.302,0-9.6,4.298-9.6,9.6s4.298,9.6,9.6,9.6s9.6-4.298,9.6-9.6  S15.302,0.4,10,0.4z M10,13.9c-4.914,0-5-0.443-5-3.9s0.086-3.9,5-3.9s5,0.443,5,3.9S14.914,13.9,10,13.9z"></path></svg></a></li></ul></li><li class="cursor-pointer pt-1"><div class="hidden-tooltip"><span class="tooltip rounded shadow-lg p-1 bg-gray-600 text-grey-500 -mt-8"> Email address copied </span> Say Hi </div></li></ul></div></div></section><section class="article container mx-auto m-width-780 p-3 py-0"><article class="article-content p-3 prose md:prose-xl"> <h1 id="how-to-backup-all-collections-from-mongodb-raspberry">How to backup all collections from mongodb (raspberry)</h1> <div class="mx-auto"> <img class="max-w-full" src="https://source.unsplash.com/zDxlNcdUzxk/960x680"> </div> <p>After some problems with my raspberry power supply and mongo 3.0 I decided to make a dayly backup. Sometimes happened that, after an unexpected shutdown (for an high load average and not too much power), some mongo collections may be broken. If it'll happen without any backup, the only words you can say are: I'm fuck.</p> <p>Yeah, I know.. if you install mongo on a 32bit system with only 1GB ram (Raspberry Pi 3), you are probabily (like me) mad. But! It's useful for some testing or a micro-system.</p> <h2 id="so-the-solution">So.. the solution</h2> <p>One of the idea that I've got is make a dayly backup. I use 3.0 mongo version, but it will be ok for &gt; 3.0 version. <strong>NOTE: you need to install mongotools.</strong></p> <p>Here is the code:</p> <p>{% highlight bash %}</p> <p>#!/bin/sh</p> <p>APP_NAME="raspberry"</p> <p>MONGO_HOST="127.0.0.1" MONGO_PORT="27017" TIMESTAMP=<code>date +%F-%H%M</code> MONGODUMP_PATH="/usr/bin/mongodump" BACKUPS_DIR="/home/pi/dump" BACKUP_NAME="$APP_NAME-$TIMESTAMP"</p> <p>$MONGODUMP_PATH</p> <p>mkdir -p $BACKUPS_DIR mv dump_file $BACKUP_NAME tar -zcvf $BACKUPS_DIR/$BACKUP_NAME.tgz $BACKUP_NAME rm -rf $BACKUP_NAME</p> <p>{% endhighlight %}</p> <p>The workflow is:</p> <ul> <li>Launch mongodump in the directory of the script</li> <li>Create the directory (if not exist) for the backup's files</li> <li>Move "dump_file" (created by mongodump cmd) to our backup name file</li> <li>make a tar (for storage saving) of the file and then remove the old one</li> </ul> <p>You need to program this script in your crontab like this: <code>30 3 * * * root /bin/bash /home/pi/mongo.sh &gt; /tmp/mongodump.log 2&gt;&amp;1 &amp;</code></p> <p>Note: for restore the collections you need to tar the file then to mongorestore</p> </article></section></div><script src="/js/chunk-vendors.f00deeb5.js"></script><script src="/js/app.05cc152f.js"></script></body></html>
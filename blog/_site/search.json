[
  
    {
      "title"    : "Raspberry won&#39;t boot - Recover data and fix bug with chroot [ubuntu]",
      "category" : "bug",
      "tags"     : "raspberry, boot, backup",
      "url"      : "https://blog.thejoin.it/raspberry-wont-boot-make-backup-with-chroot-shell.html",
      "date"     : "June 01, 2017",
      "content"  : "Two weeks ago I installed on my raspberry (raspbian wheezy) upstart package (an ubuntu package for process management)… and it was an error.\n\nYeah, because raspbian has systemd and you don’t need to install upstart!! Don’t do that!\nIt’s a little bit strange that, after installed the package, raspberry was still going.\n\nFor an unlucky event at my house the current was gone. So, the raspberry was (suddendly) powered off.\nThen it won’t boot anymore.\n\nThe error show up at the boot screen was related to “semlinux” and it can’t mount the partition.\n\nMount failed for selinuxfs on /sys/fs/selinux: No such file or directory\n\nHow you can resolve this?\n\nThere were 3 choice:\n\n  Backup or copy the whole root partition to a new sd card\n  edit cmdline.txt adding init=/bin/bash (called single-user mode or recovery mode)\n  fix the issue via chroot\n\n\nBackup\nYeah, I know.. we usually have a backup (don’t you?)… but it was not my case! :(\n\nSingle-user mode\n\nSo I tried to add init=/bin/bash to cmdline.txt file present in the boot partition.\n\nAt the startup the boot stop and, after you hit enter, you can access to the root shell.\n\nHere you can mount all the partitions and use, almost, every command.\n\nmount -rw -o remount /\n\nAfter this command you can edit file and add/remove package via apt.\n\nBefore you exit the shell, you need to sync all the disk.\n\nBut, if you are an unlucky person (like me), this mode doesn’t work for your issue.\n\nI need to remove upstart package, but in this shell I did not have a network (even via ethernet).\n\nSo, before hard reset or copy the whole root partition to a new sd image, I decided to try with chroot command.\n\nWTF is chroot?\n\nIt’s a command that can perform a change of root directory and you can exec some command (for example a /bin/bash). So, it’s like you were connect directly to raspberry via SSH.\n\nBUT!\n\nTo this you need to have a VM or a PC with ubuntu (or other linux distro) and qemu-arm installed.\n\nqemu is a package that can simulate the raspberry’s architecture (arm64).\n\nAfter installed qemu, you can mount from an img or from the sd card all the partitions.\n\nNOTE: for creating the loopback device I usually use kpartx\n\nIf you are using a img file:\nFor example (this command will create, for each partition, a device called /dev/mapper/loop0pN):\n$ sudo kpartx -a -v 2015-02-16-raspbian-wheezy.img\n\nYou need to mount the root and the boot partition, together, like this:\n\n$ sudo mount /dev/mapper/loop0p1 /mnt\n$ sudo mount /dev/mapper/loop0p1 /mnt/boot\n\nNow you have your raspberry mounted. You need to connect to it! \nWe are gonna do this using chroot command.\n\nBefore using chroot, we need to copy our /usr/bin/qemu-arm to the mounted raspberry partition, because chroot need that for start the shell.\nSo copy from /usr/bin/qemu-arm to /mnt/usr/bin/qemu-arm\n\nAfter that you can run:\nsudo chroot /mnt /usr/bin/qemu-arm\n\nIt will open a new root shell and that’s it! Remember to sync after all the edits.\n\nNOTE: remember, I’m the unluckiest man in the world, and after chroot I couldn’t connect to internet (if config did not working, even network config or dhcp or ethernet).\nSo I need to mount even the proc/ directory of my ubuntu installtion to the new mounted partition of raspberry (/mnt/proc) and re-init the chroot.\n\nAfter that, I launched ifconfig and dhcpclient config and it started to working.\n\nIt’s a little bit complex here, but I hope to be of help to you!\n",
      "snippet"  : "Two weeks ago I installed on my raspberry (raspbian wheezy) upstart package (an ubuntu package for process management)… and it..."
    } ,
  
    {
      "title"    : "Automatically setting up and connect Raspberry Pi to a Wifi network",
      "category" : "raspberry",
      "tags"     : "raspberry, wifi, static, dhcp",
      "url"      : "https://blog.thejoin.it/2017-05-17-automatically-connect-wifi-raspberry-dhcp-and-staticip.html",
      "date"     : "May 17, 2017",
      "content"  : "So you have bought your Raspberry and you want to figure out how it is working! If you wanna be cool, you don’t install GUI and do your things only by CLI and via SSH… but! You need a connection to your local network!! How connect automatically our raspberry on boot to our wifi network?\n\nEasy, with cron (or service) and via WPA config.\nHere is how.\n\nFirst of all, you need to identify your network name.\nIf you boot Raspbian to desktop, you can launch the wpa_gui (WiFi config) application and click ‘Scan’. You’ll find a list that has your network too with all flags you need.\n\nYou know, I don’t like this solution so, if you wanna be cool, you can do like this:\nsudo iwlist wlan0 scan and find out your wifi ESSID and proto.\n\nSSID is your network name.\nAfter you found it, you need to update your /etc/wpa_supplicant/wpa_supplicant.conf file.\nHere is an example:\n\nnetwork={\n\tssid=\"YOUR_NETWORK_NAME\"\n\tpsk=\"YOUR_NETWORK_PASSWORD\"\n\tproto=RSN\n\tpriority=1\n\tkey_mgmt=WPA-PSK\n\tpairwise=CCMP\n\tauth_alg=OPEN\n}\n\npsk is your network password. You need to write it there.\nThe other parameters are network specific, I can’t tell you what you need.\n\n\n  proto could be either RSN (WPA2) or WPA (WPA1).\n  key_mgmt could be either WPA-PSK (most probably) or WPA-EAP (enterprise networks)\n  pairwise could be either CCMP (WPA2) or TKIP (WPA1)\n  auth_alg is most probably OPEN, other options are LEAP and SHARED\n  priority is an incremental flag because you can specify more network connetions (just by duplicate the “network object”). Priority is an ascending field.\n\n\nAfter doing this you can run sudo ifdown wlan0 and sudo ifup wlan0 and verify your connection by ping another ip.\nNow you have connected your RPi via DHCP. What if you wanna have a static ip?\nHere we go.\n\nWe need to update our /etc/dhcpd.conf (for info about this file run man dhcpcd.conf) as the follow:\n\n/etc/dhcpcd.conf:\n\n# A sample configuration for dhcpcd.\n# See dhcpcd.conf(5) for details.\n\n# Allow users of this group to interact with dhcpcd via the control socket.\n#controlgroup wheel\n\n# Inform the DHCP server of our hostname for DDNS.\nhostname\n\n# Use the hardware address of the interface for the Client ID.\nclientid\n# or\n# Use the same DUID + IAID as set in DHCPv6 for DHCPv4 ClientID as per RFC4361.\n#duid\n\n# Persist interface configuration when dhcpcd exits.\npersistent\n\n# Rapid commit support.\n# Safe to enable by default because it requires the equivalent option set\n# on the server to actually work.\noption rapid_commit\n\n# A list of options to request from the DHCP server.\noption domain_name_servers, domain_name, domain_search, host_name\noption classless_static_routes\n# Most distributions have NTP support.\noption ntp_servers\n# Respect the network MTU.\n# Some interface drivers reset when changing the MTU so disabled by default.\n#option interface_mtu\n\n# A ServerID is required by RFC2131.\nrequire dhcp_server_identifier\n\n# Generate Stable Private IPv6 Addresses instead of hardware based ones\nslaac private\n\n# A hook script is provided to lookup the hostname if not set by the DHCP\n# server, but it should not be run by default.\nnohook lookup-hostname\n\n# look, I configured the static also per ethernet connection (just in case)\ninterface eth0\n\nstatic ip_address=192.168.1.10/24\nstatic routers=192.168.1.1\nstatic domain_name_servers=192.168.1.1\n\n# here is for wifi interface\ninterface wlan0\n\n# ip/subnet class\nstatic ip_address=192.168.1.10/24\nstatic routers=192.168.1.1\nstatic domain_name_servers=192.168.1.1\n\nIt’s pretty simply here, you need just specify your static ip and gateway. Then reboot your wifi connection.\n\nSo, now you have configured your RPi with your wifi network and static ip but… what if the wifi network goes down and reup after 5min? You need to re-connect manually…\n\nBUT! If you wanna be a cool guy:\ncheck every minute (via crontab) if we are still connected to our wifi network and it’s all up:\n\n#!/bin/bash\n\nif ifconfig wlan0 | grep -q \"inet addr:\" ; then\n   echo \"connected\"\nelse\n   echo \"Network connection down! Attempting reconnection.\"\n   ifup --force wlan0\n   sleep 10\nfi\n\nYou need to program this script in your crontab like this:\n*/10 *    * * *   root    /bin/bash /home/pi/check-wifi.sh\n",
      "snippet"  : "So you have bought your Raspberry and you want to figure out how it is working! If you wanna be..."
    } ,
  
    {
      "title"    : "How to backup all collections from mongodb (raspberry)",
      "category" : "mongodb",
      "tags"     : "raspberry, mongodb, backup",
      "url"      : "https://blog.thejoin.it/how-to-backup-all-collections-from-mongodb-on-raspberry.html",
      "date"     : "February 16, 2017",
      "content"  : "After some problems with my raspberry power supply and mongo 3.0 I decided to make a dayly backup.\nSometimes happened that, after an unexpected shutdown (for an high load average and not too much power), some mongo collections may be broken. If it’ll happen without any backup, the only words you can say are: I’m fuck.\n\nYeah, I know.. if you install mongo on a 32bit system with only 1GB ram (Raspberry Pi 3), you are probabily (like me) mad.\nBut! It’s useful for some testing or a micro-system.\n\nSo.. the solution\n\nOne of the idea that I’ve got is make a dayly backup. I use 3.0 mongo version, but it will be ok for &gt; 3.0 version.\nNOTE: you need to install mongotools.\n\nHere is the code:\n\n#!/bin/sh\n\nAPP_NAME=\"raspberry\"\n\nMONGO_HOST=\"127.0.0.1\"\nMONGO_PORT=\"27017\"\nTIMESTAMP=`date +%F-%H%M`\nMONGODUMP_PATH=\"/usr/bin/mongodump\"\nBACKUPS_DIR=\"/home/pi/dump\"\nBACKUP_NAME=\"$APP_NAME-$TIMESTAMP\"\n\n$MONGODUMP_PATH\n\nmkdir -p $BACKUPS_DIR\nmv dump_file $BACKUP_NAME\ntar -zcvf $BACKUPS_DIR/$BACKUP_NAME.tgz $BACKUP_NAME\nrm -rf $BACKUP_NAME\n\nThe workflow is:\n\n  Launch mongodump in the directory of the script\n  Create the directory (if not exist) for the backup’s files\n  Move “dump_file” (created by mongodump cmd) to our backup name file\n  make a tar (for storage saving) of the file and then remove the old one\n\n\nYou need to program this script in your crontab like this:\n30 3    * * *   root    /bin/bash /home/pi/mongo.sh &gt; /tmp/mongodump.log 2&gt;&amp;1 &amp;\n\nNote: for restore the collections you need to tar the file then to mongorestore\n",
      "snippet"  : "After some problems with my raspberry power supply and mongo 3.0 I decided to make a dayly backup. Sometimes happened..."
    } ,
  
    {
      "title"    : "Example Post",
      "category" : "test",
      "tags"     : "dev, test",
      "url"      : "https://blog.thejoin.it/example.html",
      "date"     : "September 07, 2014",
      "content"  : "post di test, ok?\n\n\n\nHeader 1\n\nHeader 2\n\nHeader 3\n\nHeader 4\n\nHeader 5\n\nHeader 6\n\nParagraphs\n\nThese are sample paragraphs showing italics, bold and code text style. Here is an unordered  list\n\n\n  Item 1\n  Item 2\n  Item 3\n\n\nand an ordered list\n\n\n  Item 1\n  Item 2\n  Item 3\n\n\n\n  A blockquote would look like this.\n\n\n\n  another one\n\n  with multiple lines\n\n\nLorem ipsum dolor sit amet, consectetuer adipiscing elit. Aenean commodo ligula eget dolor. Aenean massa. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Donec quam felis, ultricies nec, pellentesque eu, pretium quis, sem. Nulla consequat massa quis enim.\n\nDonec pede justo, fringilla vel, aliquet nec, vulputate eget, arcu. In enim justo, rhoncus ut, imperdiet a, venenatis vitae, justo. Nullam dictum felis eu pede mollis pretium. Integer tincidunt. Cras dapibus. Vivamus elementum semper nisi. Aenean vulputate eleifend tellus.\n\nLorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur.\n\nA code block would look like this.\n\n&lt;div class=\"nav\"&gt;\n    &lt;ul&gt;\n        &lt;li&gt;About&lt;/li&gt;\n        &lt;li&gt;Contact&lt;/li&gt;\n        &lt;li&gt;Project&lt;/li&gt;\n    &lt;/ul&gt;\n&lt;/div&gt;\n\nSed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo. Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit.\n\nUse below code to show Table of Contents on a page\n\n* Do not remove this line (it will not be displayed) \n{:toc}\n",
      "snippet"  : "post di test, ok?"
    } 
  
  ,
  
   {
     
   } ,
  
   {
     
        "title"    : "About",
        "category" : "",
        "tags"     : "",
        "url"      : "https://blog.thejoin.it/about/",
        "date"     : " ",
        "content"  : "",
        "snippet"  : " "
     
   } ,
  
   {
     
        "title"    : "Archive",
        "category" : "",
        "tags"     : "",
        "url"      : "https://blog.thejoin.it/archive/",
        "date"     : " ",
        "content"  : "",
        "snippet"  : " "
     
   } ,
  
   {
     
   } ,
  
   {
     
        "title"    : "Category",
        "category" : "",
        "tags"     : "",
        "url"      : "https://blog.thejoin.it/category/",
        "date"     : " ",
        "content"  : "",
        "snippet"  : " "
     
   } ,
  
   {
     
        "title"    : "Say Hello",
        "category" : "",
        "tags"     : "",
        "url"      : "https://blog.thejoin.it/contact/",
        "date"     : " ",
        "content"  : "",
        "snippet"  : " "
     
   } ,
  
   {
     
   } ,
  
   {
     
        "title"    : "Homepage",
        "category" : "",
        "tags"     : "",
        "url"      : "https://blog.thejoin.it/",
        "date"     : " ",
        "content"  : "",
        "snippet"  : " "
     
   } ,
  
   {
     
   } ,
  
   {
     
        "title"    : "Search",
        "category" : "",
        "tags"     : "",
        "url"      : "https://blog.thejoin.it/search/",
        "date"     : " ",
        "content"  : "",
        "snippet"  : " "
     
   } ,
  
   {
     
   } ,
  
   {
     
   } ,
  
   {
     
        "title"    : "Tag",
        "category" : "",
        "tags"     : "",
        "url"      : "https://blog.thejoin.it/tag/",
        "date"     : " ",
        "content"  : "",
        "snippet"  : " "
     
   } ,
  
   {
     
        "title"    : "Thanks For Your Message",
        "category" : "",
        "tags"     : "",
        "url"      : "https://blog.thejoin.it/thanks.html",
        "date"     : " ",
        "content"  : "",
        "snippet"  : " "
     
   } ,
  
   {
     
        "title"    : "Example Post",
        "category" : "test",
        "tags"     : "dev, test",
        "url"      : "https://blog.thejoin.it/example.html",
        "date"     : "September 07, 2014",
        "content"  : "",
        "snippet"  : " "
     
   } ,
  
   {
     
        "title"    : "How to backup all collections from mongodb (raspberry)",
        "category" : "mongodb",
        "tags"     : "raspberry, mongodb, backup",
        "url"      : "https://blog.thejoin.it/how-to-backup-all-collections-from-mongodb-on-raspberry.html",
        "date"     : "February 16, 2017",
        "content"  : "",
        "snippet"  : " "
     
   } ,
  
   {
     
        "title"    : "Automatically setting up and connect Raspberry Pi to a Wifi network",
        "category" : "raspberry",
        "tags"     : "raspberry, wifi, static, dhcp",
        "url"      : "https://blog.thejoin.it/2017-05-17-automatically-connect-wifi-raspberry-dhcp-and-staticip.html",
        "date"     : "May 17, 2017",
        "content"  : "",
        "snippet"  : " "
     
   } ,
  
   {
     
        "title"    : "Raspberry won&#39;t boot - Recover data and fix bug with chroot [ubuntu]",
        "category" : "bug",
        "tags"     : "raspberry, boot, backup",
        "url"      : "https://blog.thejoin.it/raspberry-wont-boot-make-backup-with-chroot-shell.html",
        "date"     : "June 01, 2017",
        "content"  : "",
        "snippet"  : " "
     
   } 
  
]
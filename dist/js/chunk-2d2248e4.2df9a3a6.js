(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d2248e4"],{e146:function(o,e){var t='<hr> <p>title: How to backup all collections from mongodb (raspberry) description: How to backup all collections and database from mongodb istance hosted in server (in this case on raspberry) permalink: how-to-backup-all-collections-from-mongodb-on-raspberry icon: zDxlNcdUzxk date: 2017-02-16 category: mongodb tags: [raspberry, mongodb, backup]</p> <hr> <h1 id="how-to-backup-all-collections-from-mongodb-raspberry">How to backup all collections from mongodb (raspberry)</h1> <div class="mx-auto"> <img class="max-w-full" src="https://source.unsplash.com/zDxlNcdUzxk/960x680"/> </div> <p>After some problems with my raspberry power supply and mongo 3.0 I decided to make a dayly backup. Sometimes happened that, after an unexpected shutdown (for an high load average and not too much power), some mongo collections may be broken. If it&#39;ll happen without any backup, the only words you can say are: I&#39;m fuck.</p> <p>Yeah, I know.. if you install mongo on a 32bit system with only 1GB ram (Raspberry Pi 3), you are probabily (like me) mad. But! It&#39;s useful for some testing or a micro-system.</p> <h2 id="so-the-solution">So.. the solution</h2> <p>One of the idea that I&#39;ve got is make a dayly backup. I use 3.0 mongo version, but it will be ok for &gt; 3.0 version. <strong>NOTE: you need to install mongotools.</strong></p> <p>Here is the code:</p> <p>{% highlight bash %}</p> <p>#!/bin/sh</p> <p>APP_NAME=&quot;raspberry&quot;</p> <p>MONGO_HOST=&quot;127.0.0.1&quot; MONGO_PORT=&quot;27017&quot; TIMESTAMP=<code>date +%F-%H%M</code> MONGODUMP_PATH=&quot;/usr/bin/mongodump&quot; BACKUPS_DIR=&quot;/home/pi/dump&quot; BACKUP_NAME=&quot;$APP_NAME-$TIMESTAMP&quot;</p> <p>$MONGODUMP_PATH</p> <p>mkdir -p $BACKUPS_DIR mv dump_file $BACKUP_NAME tar -zcvf $BACKUPS_DIR/$BACKUP_NAME.tgz $BACKUP_NAME rm -rf $BACKUP_NAME</p> <p>{% endhighlight %}</p> <p>The workflow is:</p> <ul> <li>Launch mongodump in the directory of the script</li> <li>Create the directory (if not exist) for the backup&#39;s files</li> <li>Move &quot;dump_file&quot; (created by mongodump cmd) to our backup name file</li> <li>make a tar (for storage saving) of the file and then remove the old one</li> </ul> <p>You need to program this script in your crontab like this: <code>30 3 * * * root /bin/bash /home/pi/mongo.sh &gt; /tmp/mongodump.log 2&gt;&amp;1 &amp;</code></p> <p>Note: for restore the collections you need to tar the file then to mongorestore</p> ';o.exports=t}}]);
//# sourceMappingURL=chunk-2d2248e4.2df9a3a6.js.map
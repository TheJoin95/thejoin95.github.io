<!DOCTYPE html><html lang="en" amp=""><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="icon" href="/images/icon.png"><meta name="theme-color" content="#3b4252"><title>Raspberry won't boot - Recover data and fix bug with chroot [ubuntu] - Miki Lombardi</title><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Red+Hat+Display&amp;display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tailwindcss/typography@0.2.x/dist/typography.min.css"><script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script><script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script><link href="/css/about.36c9af4f.css" rel="prefetch"><link href="/js/about.f984a725.js" rel="prefetch"><link href="/js/chunk-2d0cf6d6.e6f6d766.js" rel="prefetch"><link href="/js/chunk-2d0d6391.331694ff.js" rel="prefetch"><link href="/js/chunk-2d0d69b1.3c6cac3b.js" rel="prefetch"><link href="/js/chunk-2d0de2f3.2b4689c6.js" rel="prefetch"><link href="/js/chunk-2d0de79d.4d1d5af4.js" rel="prefetch"><link href="/js/chunk-2d0e4833.40004825.js" rel="prefetch"><link href="/js/chunk-2d0e599e.ac24a02d.js" rel="prefetch"><link href="/js/chunk-2d208114.3f138e4b.js" rel="prefetch"><link href="/js/chunk-2d2109de.141ca7ff.js" rel="prefetch"><link href="/js/chunk-2d213737.8cb5b0c4.js" rel="prefetch"><link href="/js/chunk-2d21d51b.9549b08e.js" rel="prefetch"><link href="/js/chunk-2d21eace.bb4c5b26.js" rel="prefetch"><link href="/js/chunk-2d221839.3fed34d2.js" rel="prefetch"><link href="/js/chunk-2d2248e4.2df9a3a6.js" rel="prefetch"><link href="/js/chunk-2d230282.de43d66e.js" rel="prefetch"><link href="/js/chunk-2d230644.a842f60a.js" rel="prefetch"><link href="/css/app.a4a22bc3.css" rel="preload" as="style"><link href="/js/app.05cc152f.js" rel="preload" as="script"><link href="/js/chunk-vendors.f00deeb5.js" rel="preload" as="script"><link href="/css/app.a4a22bc3.css" rel="stylesheet"><link href="https://www.googletagmanager.com" rel="preconnect"><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-98330359-1&amp;l=dataLayer" charset="utf-8"></script><script charset="utf-8" src="/js/chunk-2d221839.3fed34d2.js"></script><meta data-vue-meta="1" data-vmid="description" name="description" content="If raspberry won't boot and it's caused after you installed upstart, you can use chroot for make backup or fix the whole image"><meta data-vue-meta="1" data-vmid="og:title" name="og:title" content="Raspberry won't boot - Recover data and fix bug with chroot [ubuntu]"><meta data-vue-meta="1" data-vmid="og:type" name="og:type" content="article"><meta data-vue-meta="1" data-vmid="og:url" name="og:url" content="http://localhost:8000/blog/2017-06-01-raspberry-wont-boot-make-backup-with-chroot-shell"><meta data-vue-meta="1" data-vmid="og:site_name" name="og:site_name" content="localhost"><meta data-vue-meta="1" data-vmid="og:description" name="og:description" content="If raspberry won't boot and it's caused after you installed upstart, you can use chroot for make backup or fix the whole image"><meta data-vue-meta="1" data-vmid="og:image" name="og:image" content="https://source.unsplash.com/53jnUK5LqEY/960x680"><meta data-vue-meta="1" data-vmid="twitter:widgets:csp" name="twitter:widgets:csp" content="on"><meta data-vue-meta="1" data-vmid="twitter:card" name="twitter:card" content="https://source.unsplash.com/53jnUK5LqEY/960x680"><meta data-vue-meta="1" data-vmid="twitter:image" name="twitter:image" content="https://source.unsplash.com/53jnUK5LqEY/960x680"><meta data-vue-meta="1" data-vmid="twitter:site" name="twitter:site" content="@thejoin95"><meta data-vue-meta="1" data-vmid="twitter:creator" name="twitter:creator" content="@thejoin95"><meta data-vue-meta="1" data-vmid="twitter:domain" name="twitter:domain" content="localhost"><meta data-vue-meta="1" data-vmid="twitter:title" name="twitter:title" content="Raspberry won't boot - Recover data and fix bug with chroot [ubuntu]"><meta data-vue-meta="1" data-vmid="twitter:description" name="twitter:description" content="If raspberry won't boot and it's caused after you installed upstart, you can use chroot for make backup or fix the whole image"><script data-vue-meta="1" type="application/ld+json">{"@context":"https://schema.org","@type":"TechArticle","author":"Miki Lombardi","name":"Raspberry won't boot - Recover data and fix bug with chroot [ubuntu]","articleBody":" <h1 id=\"raspberry-wont-boot---recover-data-and-fix-bug-with-chroot-ubuntu\">Raspberry won&#39;t boot - Recover data and fix bug with chroot [ubuntu]</h1> <div class=\"mx-auto\"> <img class=\"max-w-full\" src=\"https://source.unsplash.com/53jnUK5LqEY/960x680\"/> </div> <p>Two weeks ago I installed on my raspberry (raspbian wheezy) upstart package (an ubuntu package for process management)... and it was an error.</p> <p>Yeah, because raspbian has systemd and you don&#39;t need to install upstart!! Don&#39;t do that! It&#39;s a little bit strange that, after installed the package, raspberry was still going.</p> <p>For an unlucky event at my house the current was gone. So, the raspberry was (suddendly) powered off. Then it won&#39;t boot anymore.</p> <p>The error show up at the boot screen was related to &quot;semlinux&quot; and it can&#39;t mount the partition. {% highlight bash %} Mount failed for selinuxfs on /sys/fs/selinux: No such file or directory {% endhighlight %}</p> <h2 id=\"how-you-can-resolve-this\">How you can resolve this?</h2> <p>There were 3 choice:</p> <ul> <li>Backup or copy the whole root partition to a new sd card</li> <li>edit cmdline.txt adding init=/bin/bash (called single-user mode or recovery mode)</li> <li>fix the issue via chroot</li> </ul> <h3 id=\"backup\">Backup</h3> <p>Yeah, I know.. we usually have a backup (don&#39;t you?)... but it was not my case! :(</p> <h3 id=\"single-user-mode\">Single-user mode</h3> <p>So I tried to add init=/bin/bash to cmdline.txt file present in the boot partition.</p> <p>At the startup the boot stop and, after you hit enter, you can access to the root shell.</p> <p>Here you can mount all the partitions and use, almost, every command.</p> <p><code>mount -rw -o remount /</code></p> <p>After this command you can edit file and add/remove package via apt.</p> <p>Before you exit the shell, you need to <code>sync</code> all the disk.</p> <p>But, if you are an unlucky person (like me), this mode doesn&#39;t work for your issue.</p> <p>I need to remove upstart package, but in this shell I did not have a network (even via ethernet).</p> <p>So, before hard reset or copy the whole root partition to a new sd image, I decided to try with chroot command.</p> <h3 id=\"wtf-is-chroot\">WTF is chroot?</h3> <p>It&#39;s a command that can perform a change of root directory and you can exec some command (for example a /bin/bash). So, it&#39;s like you were connect directly to raspberry via SSH.</p> <h2 id=\"but\">BUT!</h2> <p>To this you need to have a VM or a PC with ubuntu (or other linux distro) and <code>qemu-arm</code> installed.</p> <p>qemu is a package that can simulate the raspberry&#39;s architecture (arm64).</p> <p>After installed qemu, you can mount from an img or from the sd card all the partitions.</p> <p><strong>NOTE</strong>: for creating the loopback device I usually use kpartx</p> <p>If you are using a img file: For example (this command will create, for each partition, a device called /dev/mapper/loop0pN): <code>$ sudo kpartx -a -v 2015-02-16-raspbian-wheezy.img</code></p> <p>You need to mount the root and the boot partition, together, like this:</p> <p>{% highlight bash %} $ sudo mount /dev/mapper/loop0p1 /mnt $ sudo mount /dev/mapper/loop0p1 /mnt/boot {% endhighlight %}</p> <p>Now you have your raspberry mounted. You need to connect to it! We are gonna do this using chroot command.</p> <p>Before using chroot, we need to copy our /usr/bin/qemu-arm to the mounted raspberry partition, because chroot need that for start the shell. So copy from /usr/bin/qemu-arm to /mnt/usr/bin/qemu-arm</p> <p>After that you can run: <code>sudo chroot /mnt /usr/bin/qemu-arm</code></p> <p>It will open a new root shell and that&#39;s it! Remember to sync after all the edits.</p> <p>NOTE: remember, I&#39;m the unluckiest man in the world, and after chroot I couldn&#39;t connect to internet (if config did not working, even network config or dhcp or ethernet). So I need to mount even the proc/ directory of my ubuntu installtion to the new mounted partition of raspberry (/mnt/proc) and re-init the chroot.</p> <p>After that, I launched ifconfig and dhcpclient config and it started to working.</p> <p>It&#39;s a little bit complex here, but I hope to be of help to you!</p> ","abstract":"If raspberry won't boot and it's caused after you installed upstart, you can use chroot for make backup or fix the whole image"}</script></head><body><noscript><strong>We're sorry but portfolio doesn't work properly without JavaScript enabled. Please enable it to continue.</strong></noscript><div id="app"><div class="lettering content fixed"><div class="slideshow"><div class="slide slide--current"><svg class="shapes" width="800px" height="600px" viewbox="0 0 800 600"><circle r="20.6640625" cx="264.6484375" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.186165; transform-origin: 264.648px 291px; transform: translateX(-176.871px) translateY(-84.938px) scale(0.469964) rotate(-6.99489deg);"></circle><rect width="6.4471875" height="27.648" x="261.42484375" y="277.176" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.267478; transform-origin: 264.648px 291px; transform: translateX(164.641px) translateY(-46.8976px) scale(0.200131) rotate(-6.98476deg);"></rect><polygon points="243.984375 345, 264.6484375 303.671875, 285.3125 345" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0.363485; transform-origin: 264.648px 291px; transform: translateX(-191.94px) translateY(52.709px) scale(0.291702) rotate(4.97254deg);"></polygon><rect width="14.506171875" height="20.736" x="257.3953515625" y="280.632" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.474186; transform-origin: 264.648px 291px; transform: translateX(-107.666px) translateY(112.605px) scale(0.24416) rotate(2.9633deg);"></rect><circle r="20.6640625" cx="264.6484375" cy="291" fill="none" stroke-width="10" stroke="red" style="opacity: 0.59958; transform-origin: 264.648px 291px; transform: translateX(156.032px) translateY(-170.66px) scale(0.213472) rotate(-3.90079deg);"></circle><polygon points="243.984375 345, 264.6484375 303.671875, 285.3125 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.739669; transform-origin: 264.648px 291px; transform: translateX(173.506px) translateY(-183.04px) scale(0.217467) rotate(-0.953331deg);"></polygon><polygon points="243.984375 345, 264.6484375 303.671875, 285.3125 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.894451; transform-origin: 264.648px 291px; transform: translateX(-0.917325px) translateY(-21.0985px) scale(0.525198) rotate(-11.0079deg);"></polygon><rect width="5.04203125" height="18.468" x="262.127421875" y="281.766" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 264.648px 291px; transform: translateX(95.5325px) translateY(138.565px) scale(0.38418) rotate(0.860653deg);"></rect><polygon points="243.984375 345, 264.6484375 303.671875, 285.3125 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 264.648px 291px; transform: translateX(-88.3217px) translateY(89.8712px) scale(0.294505) rotate(0.774752deg);"></polygon><rect width="17.233828125" height="52.812" x="256.0315234375" y="264.594" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 264.648px 291px; transform: translateX(-11.0267px) translateY(32.4316px) scale(0.404869) rotate(4.54042deg);"></rect><circle r="26.6796875" cx="311.9921875" cy="291" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0.329843; transform-origin: 311.992px 291px; transform: translateX(-160.34px) translateY(-83.6558px) scale(0.350574) rotate(1.99181deg);"></circle><polygon points="285.3125 345, 311.9921875 291.640625, 338.671875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.435645; transform-origin: 311.992px 291px; transform: translateX(-132.73px) translateY(-4.95261px) scale(0.459905) rotate(-8.9147deg);"></polygon><rect width="22.09078125" height="35.208" x="300.946796875" y="273.396" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.556141; transform-origin: 311.992px 291px; transform: translateX(-142.132px) translateY(165.658px) scale(0.59644) rotate(-11.7627deg);"></rect><rect width="24.22515625" height="38.448" x="299.879609375" y="271.776" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.69133; transform-origin: 311.992px 291px; transform: translateX(-103.888px) translateY(148.136px) scale(0.337715) rotate(9.61922deg);"></rect><polygon points="285.3125 345, 311.9921875 291.640625, 338.671875 345" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0.841214; transform-origin: 311.992px 291px; transform: translateX(-24.2129px) translateY(121.996px) scale(0.565189) rotate(0deg);"></polygon><polygon points="285.3125 345, 311.9921875 291.640625, 338.671875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 311.992px 291px; transform: translateX(-2.64698px) translateY(96.1736px) scale(0.521758) rotate(-1.76465deg);"></polygon><polygon points="285.3125 345, 311.9921875 291.640625, 338.671875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 311.992px 291px; transform: translateX(119.475px) translateY(-65.3883px) scale(0.499889) rotate(9.68716deg);"></polygon><rect width="3.0948437500000003" height="29.376" x="310.444765625" y="276.312" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 311.992px 291px; transform: translateX(-22.2701px) translateY(70.2899px) scale(0.324731) rotate(-9.04722deg);"></rect><rect width="14.140234375" height="22.355999999999998" x="304.9220703125" y="279.822" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 311.992px 291px; transform: translateX(-51.9454px) translateY(69.6176px) scale(0.291038) rotate(5.3552deg);"></rect><rect width="23.6915625" height="44.279999999999994" x="300.14640625" y="268.86" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 311.992px 291px; transform: translateX(49.2939px) translateY(-30.6924px) scale(0.227902) rotate(4.03032deg);"></rect><polygon points="338.671875 345, 360.671875 301, 382.671875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.660003; transform-origin: 360.672px 291px; transform: translateX(69.6156px) translateY(-29.0065px) scale(0.312318) rotate(-13.5364deg);"></polygon><rect width="16.808" height="32.076" x="352.267875" y="274.962" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.80662; transform-origin: 360.672px 291px; transform: translateX(80.7906px) translateY(117.428px) scale(0.359394) rotate(1.87885deg);"></rect><polygon points="338.671875 345, 360.671875 301, 382.671875 345" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0.96793; transform-origin: 360.672px 291px; transform: translateX(68.927px) translateY(-156.652px) scale(0.423225) rotate(-12.5322deg);"></polygon><circle r="22" cx="360.671875" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 360.672px 291px; transform: translateX(0px) translateY(30.5876px) scale(0.383068) rotate(-7.44022deg);"></circle><circle r="22" cx="360.671875" cy="291" fill="none" stroke-width="10" stroke="#fff" style="opacity: 1; transform-origin: 360.672px 291px; transform: translateX(3.62219px) translateY(-40.5685px) scale(0.447556) rotate(-2.89775deg);"></circle><rect width="18.876" height="23.868" x="351.233875" y="279.06600000000003" fill="none" stroke-width="10" stroke="red" style="opacity: 1; transform-origin: 360.672px 291px; transform: translateX(73.7531px) translateY(-16.7097px) scale(0.306429) rotate(-4.60957deg);"></rect><circle r="22" cx="360.671875" cy="291" fill="none" stroke-width="10" stroke="red" style="opacity: 1; transform-origin: 360.672px 291px; transform: translateX(8.80148px) translateY(-73.3457px) scale(0.567335) rotate(1.46691deg);"></circle><circle r="22" cx="360.671875" cy="291" fill="none" stroke-width="10" stroke="#fff" style="opacity: 1; transform-origin: 360.672px 291px; transform: translateX(4.48241px) translateY(-7.11004px) scale(0.263138) rotate(-0.463698deg);"></circle><polygon points="338.671875 345, 360.671875 301, 382.671875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 360.672px 291px; transform: translateX(0px) translateY(0px) scale(0.32) rotate(0deg);"></polygon><circle r="22" cx="360.671875" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 360.672px 291px; transform: translateX(0px) translateY(0px) scale(0.56) rotate(0deg);"></circle><rect width="4.752000000000001" height="23.328" x="398.295875" y="279.336" fill="none" stroke-width="10" stroke="#000" style="opacity: 0.912516; transform-origin: 400.672px 291px; transform: translateX(-46.5221px) translateY(101.254px) scale(0.255463) rotate(-4.56099deg);"></rect><circle r="18" cx="400.671875" cy="291" fill="none" stroke-width="10" stroke="#fff" style="opacity: 1; transform-origin: 400.672px 291px; transform: translateX(-52.8704px) translateY(-160.317px) scale(0.368835) rotate(-5.96924deg);"></circle><rect width="12.564" height="13.392" x="394.389875" y="284.304" fill="none" stroke-width="10" stroke="red" style="opacity: 1; transform-origin: 400.672px 291px; transform: translateX(-77.8238px) translateY(6.10382px) scale(0.507855) rotate(6.8668deg);"></rect><polygon points="382.671875 345, 400.671875 309, 418.671875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 400.672px 291px; transform: translateX(39.1594px) translateY(-34.7382px) scale(0.472108) rotate(0deg);"></polygon><rect width="17.784" height="33.804" x="391.779875" y="274.098" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 400.672px 291px; transform: translateX(25.3336px) translateY(23.1113px) scale(0.456667) rotate(3.55559deg);"></rect><circle r="18" cx="400.671875" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 400.672px 291px; transform: translateX(27.5982px) translateY(-6.62358px) scale(0.331517) rotate(-1.28792deg);"></circle><rect width="11.736" height="5.94" x="394.803875" y="288.03" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 400.672px 291px; transform: translateX(0px) translateY(0px) scale(0.29) rotate(0deg);"></rect><rect width="2.16" height="16.092" x="399.591875" y="282.954" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 400.672px 291px; transform: translateX(0px) translateY(0px) scale(0.33) rotate(0deg);"></rect><rect width="2.016" height="11.664" x="399.663875" y="285.168" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 400.672px 291px; transform: translateX(0px) translateY(0px) scale(0.23) rotate(0deg);"></rect><polygon points="382.671875 345, 400.671875 309, 418.671875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 400.672px 291px; transform: translateX(0px) translateY(0px) scale(0.59) rotate(0deg);"></polygon><rect width="11.037125" height="46.548" x="443.14549999999997" y="267.726" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 448.664px 291px; transform: translateX(59.0272px) translateY(-97.3949px) scale(0.53427) rotate(10.3298deg);"></rect><rect width="11.337046875" height="43.955999999999996" x="442.99553906250003" y="269.022" fill="none" stroke-width="10" stroke="red" style="opacity: 1; transform-origin: 448.664px 291px; transform: translateX(50.0145px) translateY(39.8925px) scale(0.443587) rotate(-2.38164deg);"></rect><rect width="7.138140624999999" height="40.824" x="445.0949921875" y="270.588" fill="none" stroke-width="10" stroke="red" style="opacity: 1; transform-origin: 448.664px 291px; transform: translateX(-9.44672px) translateY(-28.7338px) scale(0.440427) rotate(6.29781deg);"></rect><polygon points="418.671875 345, 448.6640625 285.015625, 478.65625 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 448.664px 291px; transform: translateX(17.3454px) translateY(-8.21622px) scale(0.235976) rotate(-0.912914deg);"></polygon><rect width="10.7971875" height="42.120000000000005" x="443.26546875" y="269.94" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 448.664px 291px; transform: translateX(0px) translateY(0px) scale(0.32) rotate(0deg);"></rect><rect width="16.135796875" height="45.36" x="440.5961640625" y="268.32" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 448.664px 291px; transform: translateX(0px) translateY(0px) scale(0.58) rotate(0deg);"></rect><polygon points="418.671875 345, 448.6640625 285.015625, 478.65625 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 448.664px 291px; transform: translateX(0px) translateY(0px) scale(0.59) rotate(0deg);"></polygon><rect width="20.15475" height="51.948" x="438.5866875" y="265.026" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 448.664px 291px; transform: translateX(0px) translateY(0px) scale(0.6) rotate(0deg);"></rect><polygon points="418.671875 345, 448.6640625 285.015625, 478.65625 345" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 448.664px 291px; transform: translateX(0px) translateY(0px) scale(0.26) rotate(0deg);"></polygon><polygon points="418.671875 345, 448.6640625 285.015625, 478.65625 345" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 448.664px 291px; transform: translateX(0px) translateY(0px) scale(0.59) rotate(0deg);"></polygon><polygon points="478.65625 345, 488.671875 324.96875, 498.6875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 488.672px 291px; transform: translateX(23.4272px) translateY(37.4836px) scale(0.473775) rotate(-6.09108deg);"></polygon><polygon points="478.65625 345, 488.671875 324.96875, 498.6875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 1; transform-origin: 488.672px 291px; transform: translateX(8.68891px) translateY(25.415px) scale(0.385656) rotate(-3.04112deg);"></polygon><polygon points="478.65625 345, 488.671875 324.96875, 498.6875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 488.672px 291px; transform: translateX(0px) translateY(0px) scale(0.28) rotate(0deg);"></polygon><rect width="8.75365625" height="34.56" x="484.295046875" y="273.72" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 488.672px 291px; transform: translateX(0px) translateY(0px) scale(0.5) rotate(0deg);"></rect><rect width="4.6873125" height="36.072" x="486.32821875" y="272.964" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 488.672px 291px; transform: translateX(0px) translateY(0px) scale(0.33) rotate(0deg);"></rect><rect width="6.7705625000000005" height="6.804" x="485.28659375" y="287.598" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 488.672px 291px; transform: translateX(0px) translateY(0px) scale(0.33) rotate(0deg);"></rect><rect width="9.8153125" height="34.884" x="483.76421875" y="273.558" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 488.672px 291px; transform: translateX(0px) translateY(0px) scale(0.43) rotate(0deg);"></rect><polygon points="478.65625 345, 488.671875 324.96875, 498.6875 345" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 488.672px 291px; transform: translateX(0px) translateY(0px) scale(0.23) rotate(0deg);"></polygon><rect width="1.98309375" height="37.583999999999996" x="487.680328125" y="272.20799999999997" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 488.672px 291px; transform: translateX(0px) translateY(0px) scale(0.32) rotate(0deg);"></rect><rect width="9.234406250000001" height="40.5" x="484.054671875" y="270.75" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 488.672px 291px; transform: translateX(0px) translateY(0px) scale(0.37) rotate(0deg);"></rect><rect width="7.336" height="18.144000000000002" x="523.67575" y="281.928" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.57) rotate(0deg);"></rect><rect width="12.6660625" height="28.296" x="521.01071875" y="276.852" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.58) rotate(0deg);"></rect><polygon points="498.6875 345, 527.34375 287.6875, 556 345" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.23) rotate(0deg);"></polygon><polygon points="498.6875 345, 527.34375 287.6875, 556 345" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.43) rotate(0deg);"></polygon><polygon points="498.6875 345, 527.34375 287.6875, 556 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.48) rotate(0deg);"></polygon><circle r="28.65625" cx="527.34375" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.41) rotate(0deg);"></circle><polygon points="498.6875 345, 527.34375 287.6875, 556 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.24) rotate(0deg);"></polygon><circle r="28.65625" cx="527.34375" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.41) rotate(0deg);"></circle><polygon points="498.6875 345, 527.34375 287.6875, 556 345" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.56) rotate(0deg);"></polygon><circle r="28.65625" cx="527.34375" cy="291" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 527.344px 291px; transform: translateX(0px) translateY(0px) scale(0.43) rotate(0deg);"></circle></svg><h2 class="word word--1" aria-label="thejoin"><span class="char1" aria-hidden="true" style="opacity: 1; transform: translateY(0px);">t</span><span class="char2" aria-hidden="true" style="opacity: 1; transform: translateY(0px);">h</span><span class="char3" aria-hidden="true" style="opacity: 1; transform: translateY(5.40733e-06px);">e</span><span class="char4" aria-hidden="true" style="opacity: 1; transform: translateY(-0.0216004px);">j</span><span class="char5" aria-hidden="true" style="opacity: 1; transform: translateY(0.631066px);">o</span><span class="char6" aria-hidden="true" style="opacity: 1; transform: translateY(-5.15934px);">i</span><span class="char7" aria-hidden="true" style="opacity: 1; transform: translateY(25.9561px);">n</span></h2></div></div></div><section class="navigation relative"><div class="navigation-header fixed w-full"><div class="hidden md:block absolute say-hi tracking-wider"><a href="/" class="router-link-active"><img alt="Miki go to Home" src="/images/icon.png" class="mr-1 align-top inline-block w-6 m-w-full"></a><div class="hidden-tooltip inline-block"><span class="tooltip rounded shadow-lg p-1 bg-gray-600 text-grey-500 -mt-8"> Email address copied </span><a href="#">Say Hi.</a></div></div><div class="absolute hamburger cursor-pointer p-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-8"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg></div></div><div class="navigation-footer fixed w-full"><div class="hidden md:block absolute whoami tracking-wider"><a href="/whoami" class="">WhoAmI</a></div><div class="hidden md:block absolute writing tracking-wider"><a href="/blog" class="router-link-active">Writing</a></div></div><div class="hidden shadow md:shadow-2xl w-full md:w-1/3 h-full fixed off-canvas-menu z-10 p-5"><div class="close-header w-full border-opacity-50"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="inline w-12 cursor-pointer"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg><span class="text-4xl align-middle cursor-pointer">Close</span></div><div class="mb-5 md:mb-10 pb-3 md:pb-5 mobile-content absolute bottom-0 w-full text-3xl"><ul><li class="cursor-pointer pb-1"><a href="/" class="block router-link-active">~</a></li><li class="cursor-pointer py-1"><a href="/whoami" class="block">WhoAmI</a></li><li class="cursor-pointer py-1"><a href="/blog" class="block router-link-active">Writing</a></li><li class="cursor-pointer py-1 social-li"><span class="cursor-pointer">Social</span><ul class="social-box align-middle leading-none"><li class="inline-block pr-1"><a href="https://github.com/thejoin95" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="github-icon w-6"><path fill="#FFFFFF" d="M10.015,9.949c0,0-0.01,0-0.015,0H9.985c-1.191,0-2.24-0.303-2.861,0.268  c-0.371,0.342-0.527,0.754-0.527,1.197c0,1.852,1.483,2.08,3.389,2.08h0.029c1.905,0,3.389-0.229,3.389-2.08  c0-0.443-0.156-0.856-0.527-1.197C12.255,9.646,11.206,9.949,10.015,9.949z M8.393,12.48c-0.363,0-0.656-0.408-0.656-0.91  s0.293-0.908,0.656-0.908S9.05,11.068,9.05,11.57C9.051,12.072,8.757,12.48,8.393,12.48z M11.606,12.48  c-0.363,0-0.657-0.408-0.657-0.91s0.294-0.908,0.657-0.908c0.362,0,0.656,0.406,0.656,0.908  C12.263,12.072,11.969,12.48,11.606,12.48z M10,0.4c-5.302,0-9.6,4.298-9.6,9.6s4.298,9.6,9.6,9.6s9.6-4.298,9.6-9.6  S15.302,0.4,10,0.4z M10.876,13.939c-0.172,0-0.514,0-0.876,0.002c-0.362-0.002-0.704-0.002-0.876-0.002  c-0.76,0-3.772-0.059-3.772-3.689c0-0.834,0.286-1.445,0.755-1.955c-0.074-0.184-0.078-1.232,0.32-2.236c0,0,0.916,0.1,2.301,1.051  C9.017,7.029,9.509,6.988,10,6.988s0.982,0.041,1.273,0.121c1.385-0.951,2.301-1.051,2.301-1.051  c0.398,1.004,0.395,2.053,0.32,2.236c0.469,0.51,0.755,1.121,0.755,1.955C14.648,13.881,11.636,13.939,10.876,13.939z"></path></svg></a></li><li class="inline-block px-1"><a href="https://www.facebook.com/mikistorm/" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="fb-icon w-6"><path fill="#FFFFFF" d="M10,0.4c-5.302,0-9.6,4.298-9.6,9.6s4.298,9.6,9.6,9.6s9.6-4.298,9.6-9.6S15.302,0.4,10,0.4z M12.274,7.034  h-1.443c-0.171,0-0.361,0.225-0.361,0.524V8.6h1.805l-0.273,1.486H10.47v4.461H8.767v-4.461H7.222V8.6h1.545V7.726  c0-1.254,0.87-2.273,2.064-2.273h1.443V7.034z"></path></svg></a></li><li class="inline-block px-1"><a href="https://instagram.com/thejoin95" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="ig-icon w-6"><path fill="#FFFFFF" d="M13.89777,7.05115a1.65591,1.65591,0,0,0-.94891-0.94891,2.76589,2.76589,0,0,0-.92841-0.17218C11.49316,5.906,11.33508,5.90094,10,5.90094S8.50684,5.906,7.97955,5.93005a2.76589,2.76589,0,0,0-.92841.17218,1.65591,1.65591,0,0,0-.94891.94891,2.76589,2.76589,0,0,0-.17218.92841C5.906,8.50684,5.90094,8.665,5.90094,10s0.00507,1.49316.02911,2.02045a2.76553,2.76553,0,0,0,.17218.92841,1.65591,1.65591,0,0,0,.94891.94891,2.76589,2.76589,0,0,0,.92841.17218c0.52716,0.024.6853,0.02911,2.02045,0.02911s1.49329-.00507,2.02045-0.02911a2.76589,2.76589,0,0,0,.92841-0.17218,1.65591,1.65591,0,0,0,.94891-0.94891,2.76553,2.76553,0,0,0,.17218-0.92841c0.024-.52728.02911-0.68536,0.02911-2.02045S14.094,8.50684,14.06995,7.97955A2.76589,2.76589,0,0,0,13.89777,7.05115ZM10,12.56757A2.56757,2.56757,0,1,1,12.56757,10,2.56756,2.56756,0,0,1,10,12.56757ZM12.669,7.931a0.6,0.6,0,1,1,.6-0.6A0.6,0.6,0,0,1,12.669,7.931ZM11.66669,10A1.66669,1.66669,0,1,1,10,8.33331,1.66671,1.66671,0,0,1,11.66669,10ZM10,0.4A9.6,9.6,0,1,0,19.6,10,9.59995,9.59995,0,0,0,10,.4Zm4.96991,11.6615a3.67039,3.67039,0,0,1-.23242,1.21368,2.55612,2.55612,0,0,1-1.46228,1.46228,3.67039,3.67039,0,0,1-1.21368.23242C11.5282,14.99426,11.35791,15,10,15s-1.5282-.00574-2.06152-0.03009a3.67039,3.67039,0,0,1-1.21368-.23242,2.55612,2.55612,0,0,1-1.46228-1.46228,3.67039,3.67039,0,0,1-.23242-1.21368C5.00574,11.5282,5,11.35791,5,10s0.00574-1.5282.03009-2.06152a3.67039,3.67039,0,0,1,.23242-1.21368A2.55612,2.55612,0,0,1,6.72479,5.26251a3.67039,3.67039,0,0,1,1.21368-.23242C8.4718,5.00574,8.64209,5,10,5s1.5282,0.00574,2.06152.03009a3.67039,3.67039,0,0,1,1.21368.23242,2.55612,2.55612,0,0,1,1.46228,1.46228,3.67039,3.67039,0,0,1,.23242,1.21368C14.99426,8.4718,15,8.64209,15,10S14.99426,11.5282,14.96991,12.06152Z"></path></svg></a></li><li class="inline-block px-1"><a href="https://www.linkedin.com/in/miki-lombardi/" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="ld-icon w-6"><path fill="#FFFFFF" d="M10,0.4c-5.302,0-9.6,4.298-9.6,9.6s4.298,9.6,9.6,9.6s9.6-4.298,9.6-9.6S15.302,0.4,10,0.4z M7.65,13.979  H5.706V7.723H7.65V13.979z M6.666,6.955c-0.614,0-1.011-0.435-1.011-0.973c0-0.549,0.409-0.971,1.036-0.971s1.011,0.422,1.023,0.971  C7.714,6.52,7.318,6.955,6.666,6.955z M14.75,13.979h-1.944v-3.467c0-0.807-0.282-1.355-0.985-1.355  c-0.537,0-0.856,0.371-0.997,0.728c-0.052,0.127-0.065,0.307-0.065,0.486v3.607H8.814v-4.26c0-0.781-0.025-1.434-0.051-1.996h1.689  l0.089,0.869h0.039c0.256-0.408,0.883-1.01,1.932-1.01c1.279,0,2.238,0.857,2.238,2.699V13.979z"></path></svg></a></li><li class="inline-block px-1"><a href="https://medium.com/@thejoin95" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="md-icon w-6"><path fill="#FFFFFF" d="M10,0.3999634c-5.3019409,0-9.5999756,4.2980957-9.5999756,9.6000366S4.6980591,19.5999756,10,19.5999756  S19.5999756,15.3019409,19.5999756,10S15.3019409,0.3999634,10,0.3999634z M14.2000122,7.666687h-0.1165771  c0,0-0.3500977,0-0.3500977,0.3500977c0,0.3500366,0,3.9666748,0,3.9666748s0,0.3497925,0.3500977,0.3497925h0.1165771v0.9333496  h-2.7999878V12.333252h0.4666138V7.9933472h-0.0466309l-1.4301147,5.2732544H9.1304321L7.7133179,7.9933472H7.666687v4.3399048  h0.4666748v0.9333496h-2.333374V12.333252h0.1165771c0,0,0.3500977,0,0.3500977-0.3500366s0-3.9667358,0-3.9667358  s0-0.3497925-0.3500977-0.3497925H5.7999878V6.7333984H8.895874l1.0858765,4.0408325h0.0357666l1.0959473-4.0408325h3.0865479  V7.666687z"></path></svg></a></li><li class="inline-block px-1"><a href="https://twitter.com/thejoin95" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="tw-icon w-6"><path fill="#FFFFFF" d="M10,0.4c-5.302,0-9.6,4.298-9.6,9.6s4.298,9.6,9.6,9.6s9.6-4.298,9.6-9.6S15.302,0.4,10,0.4z M13.905,8.264  c0.004,0.082,0.005,0.164,0.005,0.244c0,2.5-1.901,5.381-5.379,5.381c-1.068,0-2.062-0.312-2.898-0.85  c0.147,0.018,0.298,0.025,0.451,0.025c0.886,0,1.701-0.301,2.348-0.809c-0.827-0.016-1.525-0.562-1.766-1.312  c0.115,0.021,0.233,0.033,0.355,0.033c0.172,0,0.34-0.023,0.498-0.066c-0.865-0.174-1.517-0.938-1.517-1.854V9.033  C6.257,9.174,6.549,9.26,6.859,9.27C6.351,8.93,6.018,8.352,6.018,7.695c0-0.346,0.093-0.672,0.256-0.951  c0.933,1.144,2.325,1.896,3.897,1.977c-0.033-0.139-0.049-0.283-0.049-0.432c0-1.043,0.846-1.891,1.891-1.891  c0.543,0,1.035,0.23,1.38,0.598c0.431-0.086,0.835-0.242,1.2-0.459c-0.141,0.441-0.44,0.812-0.831,1.047  c0.383-0.047,0.747-0.148,1.086-0.299C14.595,7.664,14.274,7.998,13.905,8.264z"></path></svg></a></li><li class="inline-block px-1"><a href="https://www.youtube.com/channel/UC1QLLgrGrPmlaFhS0orykCA" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="yt-icon w-6"><path fill="#FFFFFF" d="M11.603,9.833L9.357,8.785C9.161,8.694,9,8.796,9,9.013v1.974c0,0.217,0.161,0.319,0.357,0.228l2.245-1.048  C11.799,10.075,11.799,9.925,11.603,9.833z M10,0.4c-5.302,0-9.6,4.298-9.6,9.6s4.298,9.6,9.6,9.6s9.6-4.298,9.6-9.6  S15.302,0.4,10,0.4z M10,13.9c-4.914,0-5-0.443-5-3.9s0.086-3.9,5-3.9s5,0.443,5,3.9S14.914,13.9,10,13.9z"></path></svg></a></li></ul></li><li class="cursor-pointer pt-1"><div class="hidden-tooltip"><span class="tooltip rounded shadow-lg p-1 bg-gray-600 text-grey-500 -mt-8"> Email address copied </span> Say Hi </div></li></ul></div></div></section><section class="article container mx-auto m-width-780 p-3 py-0"><article class="article-content p-3 prose md:prose-xl"> <h1 id="raspberry-wont-boot---recover-data-and-fix-bug-with-chroot-ubuntu">Raspberry won't boot - Recover data and fix bug with chroot [ubuntu]</h1> <div class="mx-auto"> <img class="max-w-full" src="https://source.unsplash.com/53jnUK5LqEY/960x680"> </div> <p>Two weeks ago I installed on my raspberry (raspbian wheezy) upstart package (an ubuntu package for process management)... and it was an error.</p> <p>Yeah, because raspbian has systemd and you don't need to install upstart!! Don't do that! It's a little bit strange that, after installed the package, raspberry was still going.</p> <p>For an unlucky event at my house the current was gone. So, the raspberry was (suddendly) powered off. Then it won't boot anymore.</p> <p>The error show up at the boot screen was related to "semlinux" and it can't mount the partition. {% highlight bash %} Mount failed for selinuxfs on /sys/fs/selinux: No such file or directory {% endhighlight %}</p> <h2 id="how-you-can-resolve-this">How you can resolve this?</h2> <p>There were 3 choice:</p> <ul> <li>Backup or copy the whole root partition to a new sd card</li> <li>edit cmdline.txt adding init=/bin/bash (called single-user mode or recovery mode)</li> <li>fix the issue via chroot</li> </ul> <h3 id="backup">Backup</h3> <p>Yeah, I know.. we usually have a backup (don't you?)... but it was not my case! :(</p> <h3 id="single-user-mode">Single-user mode</h3> <p>So I tried to add init=/bin/bash to cmdline.txt file present in the boot partition.</p> <p>At the startup the boot stop and, after you hit enter, you can access to the root shell.</p> <p>Here you can mount all the partitions and use, almost, every command.</p> <p><code>mount -rw -o remount /</code></p> <p>After this command you can edit file and add/remove package via apt.</p> <p>Before you exit the shell, you need to <code>sync</code> all the disk.</p> <p>But, if you are an unlucky person (like me), this mode doesn't work for your issue.</p> <p>I need to remove upstart package, but in this shell I did not have a network (even via ethernet).</p> <p>So, before hard reset or copy the whole root partition to a new sd image, I decided to try with chroot command.</p> <h3 id="wtf-is-chroot">WTF is chroot?</h3> <p>It's a command that can perform a change of root directory and you can exec some command (for example a /bin/bash). So, it's like you were connect directly to raspberry via SSH.</p> <h2 id="but">BUT!</h2> <p>To this you need to have a VM or a PC with ubuntu (or other linux distro) and <code>qemu-arm</code> installed.</p> <p>qemu is a package that can simulate the raspberry's architecture (arm64).</p> <p>After installed qemu, you can mount from an img or from the sd card all the partitions.</p> <p><strong>NOTE</strong>: for creating the loopback device I usually use kpartx</p> <p>If you are using a img file: For example (this command will create, for each partition, a device called /dev/mapper/loop0pN): <code>$ sudo kpartx -a -v 2015-02-16-raspbian-wheezy.img</code></p> <p>You need to mount the root and the boot partition, together, like this:</p> <p>{% highlight bash %} $ sudo mount /dev/mapper/loop0p1 /mnt $ sudo mount /dev/mapper/loop0p1 /mnt/boot {% endhighlight %}</p> <p>Now you have your raspberry mounted. You need to connect to it! We are gonna do this using chroot command.</p> <p>Before using chroot, we need to copy our /usr/bin/qemu-arm to the mounted raspberry partition, because chroot need that for start the shell. So copy from /usr/bin/qemu-arm to /mnt/usr/bin/qemu-arm</p> <p>After that you can run: <code>sudo chroot /mnt /usr/bin/qemu-arm</code></p> <p>It will open a new root shell and that's it! Remember to sync after all the edits.</p> <p>NOTE: remember, I'm the unluckiest man in the world, and after chroot I couldn't connect to internet (if config did not working, even network config or dhcp or ethernet). So I need to mount even the proc/ directory of my ubuntu installtion to the new mounted partition of raspberry (/mnt/proc) and re-init the chroot.</p> <p>After that, I launched ifconfig and dhcpclient config and it started to working.</p> <p>It's a little bit complex here, but I hope to be of help to you!</p> </article></section></div><script src="/js/chunk-vendors.f00deeb5.js"></script><script src="/js/app.05cc152f.js"></script></body></html>
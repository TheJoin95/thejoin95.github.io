<!DOCTYPE html>
<html>
<head>
  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-5221298562415460",
      enable_page_level_ads: true
    });
  </script>
  <meta charset="utf-8">

  <link rel="shortcut icon" sizes="16x16 24x24 32x32 48x48 64x64" href="https://blog.thejoin.it/favicon.ico">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="propeller" content="4a3c54fcaa52c088c85bf945b9d8c0e2" />
  <meta name="google-site-verification" content="AaQt8BwVTJPIh7bAb8T_5SxcyVv1zknL3_SooUR6FGs" />
  
  <title>How to backup all collections from mongodb (raspberry) | TheJoin's Blog</title>

  <!-- Meta information for search engines -->
  <meta name="author" content="Miki Lombardi">
  <meta name="description" content="How to backup all collections and database from mongodb istance hosted in server (in this case on raspberry)">
  
  <meta name="keywords" content="mongodb, raspberry, mongodb, backup">
  

  <!-- Twitter Cards -->
  <meta name="twitter:card" content="summary" />
  
  <meta name="twitter:creator" content="@thejoin95" />
  
  <meta name="twitter:title" content="How to backup all collections from mongodb (raspberry)" />
  <meta name="twitter:description" content="How to backup all collections and database from mongodb istance hosted in server (in this case on raspberry)" />
  <meta name="twitter:url" content="https://blog.thejoin.it/how-to-backup-all-collections-from-mongodb-on-raspberry.html" />

  <!-- Open Graph -->
  <meta property="og:locale" content="en_US" />
  <meta property="og:type" content="article" />
  <meta property="og:title" content="How to backup all collections from mongodb (raspberry)" />
  <meta property="og:description" content="How to backup all collections and database from mongodb istance hosted in server (in this case on raspberry)" />
  <meta property="og:url" content="https://blog.thejoin.it/how-to-backup-all-collections-from-mongodb-on-raspberry.html" />
  <meta property="og:site_name" content="TheJoin's Blog">

  <link rel="stylesheet" href="/css/main.css">
  <!--   Syntax highlighting is only needed for posts -->
  
  <link rel="stylesheet" href="/css/syntax-highlighter.css">
  
  <link href="//fonts.googleapis.com/css?family=Space+Mono|Work+Sans:700" rel="stylesheet">    
  <!-- Set the canonical URL for search engines -->
  <link rel="canonical" href="https://blog.thejoin.it/how-to-backup-all-collections-from-mongodb-on-raspberry.html">
  
  <link rel="amphtml" href="https://blog.thejoin.it/amp/how-to-backup-mongodb-on-raspberry.html">
  

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS Feed for TheJoin's Blog" href="https://blog.thejoin.it/feed.xml" />
  <meta name="theme-color" content="#3d8fd1" />

</head>
<body>

<input type="checkbox" id="hamburger" name="hamburger">
<label id="label-ham" for="hamburger"></label>
<div class="menu-container">
  <div class="menu"></div>
  <div class="links">
      <a href="/"><i class="fa fa-home"></i>&nbsp;Home</a>
      <a href="/about/"><i class="fa fa-user"></i>&nbsp;About</a>
      <a href="/archive/"><i class="fa fa-file-zip-o"></i>&nbsp;Archive</a>
      <a href="/contact/"><i class="fa fa-address-book-o"></i>&nbsp;Contact</a>
  </div>
</div>

<div class="content">
<header>
     <a href="/"><h1 class="site-title">TheJoin's Blog</h1></a>
</header>
  <br/>

<div class="blog-post" itemscope itemType="https://schema.org/BlogPosting">
  <meta itemprop="inLanguage" content="en-US"/>
  <div class="post-title">
      <div class="logo">
          
              <i class="fa fa-database fa-fw"></i>
          
      </div>
      <div class="title">
          <h2 itemprop="headline">How to backup all collections from mongodb (raspberry)</h2>
          
          <span>
              <time itemprop="datePublished" content="2017-02-16T00:00:00+01:00" datetime="2017-02-16T00:00:00+01:00">
                  February 16, 2017
                  
                      &middot;
                      <a href="https://blog.thejoin.it/how-to-backup-all-collections-from-mongodb-on-raspberry.htmlindex.html#disqus_thread" data-disqus-identifier="/how-to-backup-all-collections-from-mongodb-on-raspberry.html"></a>
                      
                  
              </time>
          </span>
          
          <br/>
          category: <a class="codinfox-tag-mark" href="https://blog.thejoin.it/category/#mongodb">mongodb</a>
          
          
          | tags: 
          
          <a class="codinfox-tag-mark" href="https://blog.thejoin.it/tag/#raspberry">raspberry</a>
          
          <a class="codinfox-tag-mark" href="https://blog.thejoin.it/tag/#mongodb">mongodb</a>
          
          <a class="codinfox-tag-mark" href="https://blog.thejoin.it/tag/#backup">backup</a>
          
          
      </div>
  </div>

  <div itemprop="articleBody">
    <br/>
    <p>After some problems with my raspberry power supply and mongo 3.0 I decided to make a dayly backup.
Sometimes happened that, after an unexpected shutdown (for an high load average and not too much power), some mongo collections may be broken. If it’ll happen without any backup, the only words you can say are: I’m fuck.</p>

<p>Yeah, I know.. if you install mongo on a 32bit system with only 1GB ram (Raspberry Pi 3), you are probabily (like me) mad.
But! It’s useful for some testing or a micro-system.</p>

<h2 id="so-the-solution">So.. the solution</h2>

<p>One of the idea that I’ve got is make a dayly backup. I use 3.0 mongo version, but it will be ok for &gt; 3.0 version.
<strong>NOTE: you need to install mongotools.</strong></p>

<p>Here is the code:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="c">#!/bin/sh</span>

<span class="nv">APP_NAME</span><span class="o">=</span><span class="s2">"raspberry"</span>

<span class="nv">MONGO_HOST</span><span class="o">=</span><span class="s2">"127.0.0.1"</span>
<span class="nv">MONGO_PORT</span><span class="o">=</span><span class="s2">"27017"</span>
<span class="nv">TIMESTAMP</span><span class="o">=</span><span class="sb">`</span>date +%F-%H%M<span class="sb">`</span>
<span class="nv">MONGODUMP_PATH</span><span class="o">=</span><span class="s2">"/usr/bin/mongodump"</span>
<span class="nv">BACKUPS_DIR</span><span class="o">=</span><span class="s2">"/home/pi/dump"</span>
<span class="nv">BACKUP_NAME</span><span class="o">=</span><span class="s2">"</span><span class="nv">$APP_NAME</span><span class="s2">-</span><span class="nv">$TIMESTAMP</span><span class="s2">"</span>

<span class="nv">$MONGODUMP_PATH</span>

mkdir -p <span class="nv">$BACKUPS_DIR</span>
mv dump_file <span class="nv">$BACKUP_NAME</span>
tar -zcvf <span class="nv">$BACKUPS_DIR</span>/<span class="nv">$BACKUP_NAME</span>.tgz <span class="nv">$BACKUP_NAME</span>
rm -rf <span class="nv">$BACKUP_NAME</span></code></pre></figure>

<p>The workflow is:</p>
<ul>
  <li>Launch mongodump in the directory of the script</li>
  <li>Create the directory (if not exist) for the backup’s files</li>
  <li>Move “dump_file” (created by mongodump cmd) to our backup name file</li>
  <li>make a tar (for storage saving) of the file and then remove the old one</li>
</ul>

<p>You need to program this script in your crontab like this:
<code class="highlighter-rouge">30 3    * * *   root    /bin/bash /home/pi/mongo.sh &gt; /tmp/mongodump.log 2&gt;&amp;1 &amp;</code></p>

<p>Note: for restore the collections you need to tar the file then to mongorestore</p>

  </div>

  <meta itemprop="publisher" content="https://blog.thejoin.it"/>
  <meta itemprop="image" content="https://blog.thejoin.it/favicon.ico" />
  <div style="display: none" itemprop="author">
   <span itemscope itemtype="https://schema.org/Person">
     Posted by 
     <span itemprop="name">Miki Lombardi</span>, 
     <span itemprop="worksFor">Aperion</span>
   </span>
  </div>

  <div class="sharing">
      <br/>
      <br/>
  <!-- Make an animated slide out drawer later -->
      <ul>
          <li><i class="fa fa-share-square-o"></i></li>
          
          <li><a href="https://twitter.com/intent/tweet?text=How to backup all collections from mongodb (raspberry)&url=https://blog.thejoin.it/how-to-backup-all-collections-from-mongodb-on-raspberry.html" rel="nofollow" target="_blank" title="Share on Twitter">
                  <i class="fa fa-twitter-square"></i>
          </a></li>
          

          
          <li><a href="https://www.linkedin.com/shareArticle?url=https://blog.thejoin.it/how-to-backup-all-collections-from-mongodb-on-raspberry.html&title=How to backup all collections from mongodb (raspberry)" rel="nofollow" target="_blank" title="Share on LinkedIn">
                  <i class="fa fa-linkedin-square"></i>
          </a></li>
          

          
          <li><a href="https://facebook.com/sharer.php?u=https://blog.thejoin.it/how-to-backup-all-collections-from-mongodb-on-raspberry.html" rel="nofollow" target="_blank" title="Share on Facebook">
                  <i class="fa fa-facebook-square"></i>
          </a></li>
          

          
          <li><a href="https://plus.google.com/share?url=https://blog.thejoin.it/how-to-backup-all-collections-from-mongodb-on-raspberry.html" rel="nofollow" target="_blank" title="Share on Google+">
                  <i class="fa fa-google-plus-square"></i>
          </a></li>
          

          
          <li><a href="https://reddit.com/submit?url=https://blog.thejoin.it/how-to-backup-all-collections-from-mongodb-on-raspberry.html&title=How to backup all collections from mongodb (raspberry)" rel="nofollow" target="_blank" title="Share on Reddit">
                  <i class="fa fa-reddit-square"></i>
          </a></li>
          
      </ul>
  </div>

  <br/>
  <br/>

  
  


  
  

  <br/>
  <br/>

  
  <div id="disqus_thread"></div>
  <!-- Add Disqus comments (not comment count) -->
  <script type="text/javascript">
      var disqus_shortname  = 'thejoin';
      var disqus_identifier = '/how-to-backup-all-collections-from-mongodb-on-raspberry.html';
      var disqus_title      = 'How to backup all collections from mongodb (raspberry)';
      var disqus_url        = 'https://blog.thejoin.it/how-to-backup-all-collections-from-mongodb-on-raspberry.html';
      // var disqus_developer = 1; // Comment out when the site is live

      (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
      })();
  </script>

<!--   
  <script type="text/javascript">
    /* * * CONFIGURATION VARIABLES * * */
    var disqus_shortname  = 'thejoin';
    // var disqus_developer = 1; // Comment out when the site is live

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = '//' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
  </script> -->

  <noscript>
      Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a>
  </noscript>
  
</div>
  
    <footer>
      <small>Theme based on <a href="https://github.com/ankur-gupta/trio/" target="_blank">trio</a></small>
  </footer>
</div>
  <!-- Calling Fontawesome at the end to avoid delay in loading --> 
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
<!-- Google Analytics Tracking code -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-98330359-2', 'auto');
  ga('send', 'pageview');

</script>
</body>
</html>

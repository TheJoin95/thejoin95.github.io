<!DOCTYPE html><html lang="en" amp=""><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="icon" href="/images/icon.png"><meta name="theme-color" content="#3b4252"><title>Raspberry won't boot - Recover data and fix bug with chroot [ubuntu] - Miki Lombardi</title><link rel="preconnect" href="https://fonts.gstatic.com"><link href="https://fonts.googleapis.com/css2?family=Red+Hat+Display&amp;display=swap" rel="stylesheet"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tailwindcss/typography@0.2.x/dist/typography.min.css"><script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script><script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script><link href="/css/about.1312b8c5.css" rel="prefetch"><link href="/js/about.675f5ff8.js" rel="prefetch"><link href="/js/chunk-2d0cf6d6.e6f6d766.js" rel="prefetch"><link href="/js/chunk-2d0d6391.331694ff.js" rel="prefetch"><link href="/js/chunk-2d0d69b1.3c6cac3b.js" rel="prefetch"><link href="/js/chunk-2d0de2f3.2b4689c6.js" rel="prefetch"><link href="/js/chunk-2d0de79d.4d1d5af4.js" rel="prefetch"><link href="/js/chunk-2d0e4833.40004825.js" rel="prefetch"><link href="/js/chunk-2d0e599e.ac24a02d.js" rel="prefetch"><link href="/js/chunk-2d208114.3f138e4b.js" rel="prefetch"><link href="/js/chunk-2d2109de.141ca7ff.js" rel="prefetch"><link href="/js/chunk-2d213737.8cb5b0c4.js" rel="prefetch"><link href="/js/chunk-2d21d51b.9549b08e.js" rel="prefetch"><link href="/js/chunk-2d21eace.bb4c5b26.js" rel="prefetch"><link href="/js/chunk-2d221839.3fed34d2.js" rel="prefetch"><link href="/js/chunk-2d2248e4.2df9a3a6.js" rel="prefetch"><link href="/js/chunk-2d230282.de43d66e.js" rel="prefetch"><link href="/js/chunk-2d230644.a842f60a.js" rel="prefetch"><link href="/css/app.755b211d.css" rel="preload" as="style"><link href="/js/app.c1e52978.js" rel="preload" as="script"><link href="/js/chunk-vendors.f00deeb5.js" rel="preload" as="script"><link href="/css/app.755b211d.css" rel="stylesheet"><link href="https://www.googletagmanager.com" rel="preconnect"><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-98330359-1&amp;l=dataLayer" charset="utf-8"></script><script charset="utf-8" src="/js/chunk-2d221839.3fed34d2.js"></script><meta data-vue-meta="1" data-vmid="description" name="description" content="If raspberry won't boot and it's caused after you installed upstart, you can use chroot for make backup or fix the whole image"><meta data-vue-meta="1" data-vmid="og:title" name="og:title" content="Raspberry won't boot - Recover data and fix bug with chroot [ubuntu]"><meta data-vue-meta="1" data-vmid="og:type" name="og:type" content="article"><meta data-vue-meta="1" data-vmid="og:url" name="og:url" content="http://localhost:8000/blog/2017-06-01-raspberry-wont-boot-make-backup-with-chroot-shell"><meta data-vue-meta="1" data-vmid="og:site_name" name="og:site_name" content="localhost"><meta data-vue-meta="1" data-vmid="og:description" name="og:description" content="If raspberry won't boot and it's caused after you installed upstart, you can use chroot for make backup or fix the whole image"><meta data-vue-meta="1" data-vmid="og:image" name="og:image" content="https://source.unsplash.com/53jnUK5LqEY/960x680"><meta data-vue-meta="1" data-vmid="twitter:widgets:csp" name="twitter:widgets:csp" content="on"><meta data-vue-meta="1" data-vmid="twitter:card" name="twitter:card" content="https://source.unsplash.com/53jnUK5LqEY/960x680"><meta data-vue-meta="1" data-vmid="twitter:image" name="twitter:image" content="https://source.unsplash.com/53jnUK5LqEY/960x680"><meta data-vue-meta="1" data-vmid="twitter:site" name="twitter:site" content="@thejoin95"><meta data-vue-meta="1" data-vmid="twitter:creator" name="twitter:creator" content="@thejoin95"><meta data-vue-meta="1" data-vmid="twitter:domain" name="twitter:domain" content="localhost"><meta data-vue-meta="1" data-vmid="twitter:title" name="twitter:title" content="Raspberry won't boot - Recover data and fix bug with chroot [ubuntu]"><meta data-vue-meta="1" data-vmid="twitter:description" name="twitter:description" content="If raspberry won't boot and it's caused after you installed upstart, you can use chroot for make backup or fix the whole image"><script data-vue-meta="1" type="application/ld+json">{"@context":"https://schema.org","@type":"TechArticle","author":"Miki Lombardi","name":"Raspberry won't boot - Recover data and fix bug with chroot [ubuntu]","articleBody":" <h1 id=\"raspberry-wont-boot---recover-data-and-fix-bug-with-chroot-ubuntu\">Raspberry won&#39;t boot - Recover data and fix bug with chroot [ubuntu]</h1> <div class=\"mx-auto\"> <img class=\"max-w-full\" src=\"https://source.unsplash.com/53jnUK5LqEY/960x680\"/> </div> <p>Two weeks ago I installed on my raspberry (raspbian wheezy) upstart package (an ubuntu package for process management)... and it was an error.</p> <p>Yeah, because raspbian has systemd and you don&#39;t need to install upstart!! Don&#39;t do that! It&#39;s a little bit strange that, after installed the package, raspberry was still going.</p> <p>For an unlucky event at my house the current was gone. So, the raspberry was (suddendly) powered off. Then it won&#39;t boot anymore.</p> <p>The error show up at the boot screen was related to &quot;semlinux&quot; and it can&#39;t mount the partition. {% highlight bash %} Mount failed for selinuxfs on /sys/fs/selinux: No such file or directory {% endhighlight %}</p> <h2 id=\"how-you-can-resolve-this\">How you can resolve this?</h2> <p>There were 3 choice:</p> <ul> <li>Backup or copy the whole root partition to a new sd card</li> <li>edit cmdline.txt adding init=/bin/bash (called single-user mode or recovery mode)</li> <li>fix the issue via chroot</li> </ul> <h3 id=\"backup\">Backup</h3> <p>Yeah, I know.. we usually have a backup (don&#39;t you?)... but it was not my case! :(</p> <h3 id=\"single-user-mode\">Single-user mode</h3> <p>So I tried to add init=/bin/bash to cmdline.txt file present in the boot partition.</p> <p>At the startup the boot stop and, after you hit enter, you can access to the root shell.</p> <p>Here you can mount all the partitions and use, almost, every command.</p> <p><code>mount -rw -o remount /</code></p> <p>After this command you can edit file and add/remove package via apt.</p> <p>Before you exit the shell, you need to <code>sync</code> all the disk.</p> <p>But, if you are an unlucky person (like me), this mode doesn&#39;t work for your issue.</p> <p>I need to remove upstart package, but in this shell I did not have a network (even via ethernet).</p> <p>So, before hard reset or copy the whole root partition to a new sd image, I decided to try with chroot command.</p> <h3 id=\"wtf-is-chroot\">WTF is chroot?</h3> <p>It&#39;s a command that can perform a change of root directory and you can exec some command (for example a /bin/bash). So, it&#39;s like you were connect directly to raspberry via SSH.</p> <h2 id=\"but\">BUT!</h2> <p>To this you need to have a VM or a PC with ubuntu (or other linux distro) and <code>qemu-arm</code> installed.</p> <p>qemu is a package that can simulate the raspberry&#39;s architecture (arm64).</p> <p>After installed qemu, you can mount from an img or from the sd card all the partitions.</p> <p><strong>NOTE</strong>: for creating the loopback device I usually use kpartx</p> <p>If you are using a img file: For example (this command will create, for each partition, a device called /dev/mapper/loop0pN): <code>$ sudo kpartx -a -v 2015-02-16-raspbian-wheezy.img</code></p> <p>You need to mount the root and the boot partition, together, like this:</p> <p>{% highlight bash %} $ sudo mount /dev/mapper/loop0p1 /mnt $ sudo mount /dev/mapper/loop0p1 /mnt/boot {% endhighlight %}</p> <p>Now you have your raspberry mounted. You need to connect to it! We are gonna do this using chroot command.</p> <p>Before using chroot, we need to copy our /usr/bin/qemu-arm to the mounted raspberry partition, because chroot need that for start the shell. So copy from /usr/bin/qemu-arm to /mnt/usr/bin/qemu-arm</p> <p>After that you can run: <code>sudo chroot /mnt /usr/bin/qemu-arm</code></p> <p>It will open a new root shell and that&#39;s it! Remember to sync after all the edits.</p> <p>NOTE: remember, I&#39;m the unluckiest man in the world, and after chroot I couldn&#39;t connect to internet (if config did not working, even network config or dhcp or ethernet). So I need to mount even the proc/ directory of my ubuntu installtion to the new mounted partition of raspberry (/mnt/proc) and re-init the chroot.</p> <p>After that, I launched ifconfig and dhcpclient config and it started to working.</p> <p>It&#39;s a little bit complex here, but I hope to be of help to you!</p> ","abstract":"If raspberry won't boot and it's caused after you installed upstart, you can use chroot for make backup or fix the whole image"}</script></head><body><noscript><strong>We're sorry but portfolio doesn't work properly without JavaScript enabled. Please enable it to continue.</strong></noscript><div id="app"><div class="lettering content fixed" style="opacity: -1; display: none;"><div class="slideshow"><div class="slide slide--current"><svg class="shapes" width="800px" height="600px" viewbox="0 0 800 600"><rect width="9.14875" height="27.648" x="261.3709375" y="277.176" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 265.945px 291px; transform: translateX(-117px) translateY(126px) scale(0.25) rotate(-9deg);"></rect><circle r="21.9921875" cx="265.9453125" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 265.945px 291px; transform: translateX(183px) translateY(-24px) scale(0.59) rotate(-13deg);"></circle><rect width="9.632578125" height="5.508" x="261.1290234375" y="288.246" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 265.945px 291px; transform: translateX(191px) translateY(-38px) scale(0.21) rotate(-15deg);"></rect><rect width="7.169453125" height="51.948" x="262.3605859375" y="265.026" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 265.945px 291px; transform: translateX(175px) translateY(73px) scale(0.49) rotate(1deg);"></rect><polygon points="243.953125 345, 265.9453125 301.015625, 287.9375 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 265.945px 291px; transform: translateX(-58px) translateY(-150px) scale(0.57) rotate(-11deg);"></polygon><rect width="6.201796874999999" height="6.156000000000001" x="262.8444140625" y="287.922" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 265.945px 291px; transform: translateX(-146px) translateY(137px) scale(0.55) rotate(-15deg);"></rect><rect width="15.526484374999999" height="15.227999999999998" x="258.1820703125" y="283.386" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 265.945px 291px; transform: translateX(-171px) translateY(-190px) scale(0.35) rotate(-14deg);"></rect><circle r="21.9921875" cx="265.9453125" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 265.945px 291px; transform: translateX(-8px) translateY(-16px) scale(0.41) rotate(-10deg);"></circle><polygon points="243.953125 345, 265.9453125 301.015625, 287.9375 345" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 265.945px 291px; transform: translateX(-20px) translateY(-24px) scale(0.34) rotate(3deg);"></polygon><circle r="21.9921875" cx="265.9453125" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 265.945px 291px; transform: translateX(127px) translateY(-114px) scale(0.4) rotate(16deg);"></circle><polygon points="287.9375 345, 313.9375 293, 339.9375 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 313.938px 291px; transform: translateX(-190px) translateY(134px) scale(0.24) rotate(15deg);"></polygon><polygon points="287.9375 345, 313.9375 293, 339.9375 345" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 313.938px 291px; transform: translateX(32px) translateY(92px) scale(0.52) rotate(4deg);"></polygon><polygon points="287.9375 345, 313.9375 293, 339.9375 345" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 313.938px 291px; transform: translateX(-83px) translateY(-123px) scale(0.53) rotate(3deg);"></polygon><polygon points="287.9375 345, 313.9375 293, 339.9375 345" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 313.938px 291px; transform: translateX(-40px) translateY(109px) scale(0.4) rotate(5deg);"></polygon><polygon points="287.9375 345, 313.9375 293, 339.9375 345" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 313.938px 291px; transform: translateX(116px) translateY(-78px) scale(0.46) rotate(12deg);"></polygon><rect width="16.952" height="38.232" x="305.4615" y="271.884" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 313.938px 291px; transform: translateX(-185px) translateY(-143px) scale(0.24) rotate(1deg);"></rect><polygon points="287.9375 345, 313.9375 293, 339.9375 345" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 313.938px 291px; transform: translateX(23px) translateY(-182px) scale(0.36) rotate(12deg);"></polygon><circle r="26" cx="313.9375" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 313.938px 291px; transform: translateX(143px) translateY(-1px) scale(0.37) rotate(7deg);"></circle><circle r="26" cx="313.9375" cy="291" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 313.938px 291px; transform: translateX(13px) translateY(-132px) scale(0.4) rotate(15deg);"></circle><rect width="17.212" height="22.032" x="305.3315" y="279.984" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 313.938px 291px; transform: translateX(-70px) translateY(-161px) scale(0.31) rotate(4deg);"></rect><polygon points="339.9375 345, 363.953125 296.96875, 387.96875 345" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 363.953px 291px; transform: translateX(-125px) translateY(192px) scale(0.49) rotate(16deg);"></polygon><rect width="22.046343750000002" height="35.748000000000005" x="352.929953125" y="273.126" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 363.953px 291px; transform: translateX(139px) translateY(-17px) scale(0.47) rotate(-12deg);"></rect><circle r="24.015625" cx="363.953125" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 363.953px 291px; transform: translateX(98px) translateY(-20px) scale(0.54) rotate(-9deg);"></circle><circle r="24.015625" cx="363.953125" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 363.953px 291px; transform: translateX(121px) translateY(-195px) scale(0.51) rotate(-9deg);"></circle><circle r="24.015625" cx="363.953125" cy="291" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 363.953px 291px; transform: translateX(52px) translateY(-115px) scale(0.5) rotate(4deg);"></circle><rect width="22.43059375" height="22.68" x="352.737828125" y="279.65999999999997" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 363.953px 291px; transform: translateX(75px) translateY(107px) scale(0.3) rotate(-16deg);"></rect><rect width="22.71878125" height="39.312" x="352.593734375" y="271.344" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 363.953px 291px; transform: translateX(59px) translateY(-35px) scale(0.33) rotate(15deg);"></rect><rect width="13.352687500000002" height="23.868" x="357.27678125" y="279.06600000000003" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 363.953px 291px; transform: translateX(35px) translateY(147px) scale(0.46) rotate(-11deg);"></rect><rect width="23.19909375" height="18.683999999999997" x="352.353578125" y="281.658" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 363.953px 291px; transform: translateX(-58px) translateY(-30px) scale(0.34) rotate(14deg);"></rect><rect width="4.9952499999999995" height="5.724" x="361.45550000000003" y="288.138" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 363.953px 291px; transform: translateX(-168px) translateY(103px) scale(0.49) rotate(5deg);"></rect><rect width="13.45575" height="16.956" x="401.2643125" y="282.522" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 407.992px 291px; transform: translateX(-182px) translateY(-161px) scale(0.52) rotate(-16deg);"></rect><rect width="8.209609375" height="19.764" x="403.8873828125" y="281.118" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 407.992px 291px; transform: translateX(95px) translateY(-95px) scale(0.35) rotate(3deg);"></rect><polygon points="387.96875 345, 407.9921875 304.953125, 428.015625 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 407.992px 291px; transform: translateX(-161px) translateY(-162px) scale(0.39) rotate(-1deg);"></polygon><rect width="2.3627656249999998" height="50.328" x="406.8108046875" y="265.836" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 407.992px 291px; transform: translateX(-12px) translateY(-16px) scale(0.35) rotate(2deg);"></rect><polygon points="387.96875 345, 407.9921875 304.953125, 428.015625 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 407.992px 291px; transform: translateX(182px) translateY(-105px) scale(0.22) rotate(12deg);"></polygon><rect width="14.376828125" height="46.656" x="400.8037734375" y="267.672" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 407.992px 291px; transform: translateX(30px) translateY(58px) scale(0.58) rotate(-1deg);"></rect><polygon points="387.96875 345, 407.9921875 304.953125, 428.015625 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 407.992px 291px; transform: translateX(179px) translateY(65px) scale(0.31) rotate(-9deg);"></polygon><polygon points="387.96875 345, 407.9921875 304.953125, 428.015625 345" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 407.992px 291px; transform: translateX(188px) translateY(-79px) scale(0.32) rotate(-4deg);"></polygon><rect width="5.04590625" height="21.168" x="405.469234375" y="280.416" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 407.992px 291px; transform: translateX(-136px) translateY(106px) scale(0.39) rotate(4deg);"></rect><polygon points="387.96875 345, 407.9921875 304.953125, 428.015625 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 407.992px 291px; transform: translateX(56px) translateY(47px) scale(0.32) rotate(-11deg);"></polygon><rect width="24.98296875" height="34.776" x="443.531953125" y="273.61199999999997" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 456.023px 291px; transform: translateX(-93px) translateY(121px) scale(0.51) rotate(10deg);"></rect><polygon points="428.015625 345, 456.0234375 288.984375, 484.03125 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 456.023px 291px; transform: translateX(-4px) translateY(-86px) scale(0.5) rotate(16deg);"></polygon><rect width="3.304921875" height="48.168" x="454.3709765625" y="266.916" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 456.023px 291px; transform: translateX(74px) translateY(22px) scale(0.25) rotate(14deg);"></rect><circle r="28.0078125" cx="456.0234375" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 456.023px 291px; transform: translateX(-81px) translateY(180px) scale(0.24) rotate(11deg);"></circle><rect width="11.147109375000001" height="8.64" x="450.4498828125" y="286.68" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 456.023px 291px; transform: translateX(-120px) translateY(-178px) scale(0.3) rotate(7deg);"></rect><rect width="18.70921875" height="19.008" x="446.668828125" y="281.496" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 456.023px 291px; transform: translateX(-51px) translateY(-131px) scale(0.37) rotate(13deg);"></rect><rect width="21.061875" height="17.172" x="445.4925" y="282.414" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 456.023px 291px; transform: translateX(-54px) translateY(-156px) scale(0.28) rotate(4deg);"></rect><rect width="15.068203125" height="49.356" x="448.4893359375" y="266.322" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 456.023px 291px; transform: translateX(141px) translateY(-80px) scale(0.32) rotate(16deg);"></rect><rect width="10.586953125" height="35.964" x="450.7299609375" y="273.01800000000003" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 456.023px 291px; transform: translateX(-40px) translateY(-163px) scale(0.3) rotate(4deg);"></rect><circle r="28.0078125" cx="456.0234375" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 456.023px 291px; transform: translateX(98px) translateY(-137px) scale(0.32) rotate(-4deg);"></circle><rect width="9.28725" height="48.384" x="489.3954375" y="266.808" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 494.039px 291px; transform: translateX(56px) translateY(-26px) scale(0.4) rotate(9deg);"></rect><polygon points="484.03125 345, 494.0390625 324.984375, 504.046875 345" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 494.039px 291px; transform: translateX(-180px) translateY(156px) scale(0.28) rotate(6deg);"></polygon><rect width="1.3810781250000002" height="26.567999999999998" x="493.3485234375" y="277.716" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 494.039px 291px; transform: translateX(2px) translateY(-66px) scale(0.4) rotate(-16deg);"></rect><rect width="4.963875" height="15.012" x="491.557125" y="283.494" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 494.039px 291px; transform: translateX(-143px) translateY(-56px) scale(0.49) rotate(-16deg);"></rect><rect width="9.6875625" height="31.535999999999998" x="489.19528125" y="275.23199999999997" fill="none" stroke-width="10" stroke="#fff" style="opacity: 0; transform-origin: 494.039px 291px; transform: translateX(27px) translateY(-61px) scale(0.2) rotate(-7deg);"></rect><polygon points="484.03125 345, 494.0390625 324.984375, 504.046875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 494.039px 291px; transform: translateX(191px) translateY(91px) scale(0.37) rotate(-11deg);"></polygon><circle r="10.0078125" cx="494.0390625" cy="291" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 494.039px 291px; transform: translateX(-75px) translateY(46px) scale(0.2) rotate(-14deg);"></circle><circle r="10.0078125" cx="494.0390625" cy="291" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 494.039px 291px; transform: translateX(-190px) translateY(160px) scale(0.23) rotate(-5deg);"></circle><rect width="4.92384375" height="29.484" x="491.577140625" y="276.258" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 494.039px 291px; transform: translateX(-128px) translateY(-69px) scale(0.59) rotate(-11deg);"></rect><polygon points="484.03125 345, 494.0390625 324.984375, 504.046875 345" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 494.039px 291px; transform: translateX(-108px) translateY(144px) scale(0.32) rotate(-15deg);"></polygon><circle r="26" cx="530.046875" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 530.047px 291px; transform: translateX(-171px) translateY(20px) scale(0.24) rotate(12deg);"></circle><rect width="4.16" height="24.084" x="527.966875" y="278.95799999999997" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 530.047px 291px; transform: translateX(32px) translateY(-179px) scale(0.45) rotate(3deg);"></rect><rect width="18.72" height="53.568" x="520.686875" y="264.216" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 530.047px 291px; transform: translateX(-25px) translateY(76px) scale(0.23) rotate(-16deg);"></rect><circle r="26" cx="530.046875" cy="291" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 530.047px 291px; transform: translateX(-181px) translateY(129px) scale(0.25) rotate(-5deg);"></circle><circle r="26" cx="530.046875" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 530.047px 291px; transform: translateX(99px) translateY(-121px) scale(0.31) rotate(1deg);"></circle><rect width="4.316" height="28.188000000000002" x="527.888875" y="276.906" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 530.047px 291px; transform: translateX(-164px) translateY(-43px) scale(0.42) rotate(-12deg);"></rect><polygon points="504.046875 345, 530.046875 293, 556.046875 345" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 530.047px 291px; transform: translateX(-26px) translateY(-8px) scale(0.35) rotate(-1deg);"></polygon><circle r="26" cx="530.046875" cy="291" fill="none" stroke-width="10" stroke="#000" style="opacity: 0; transform-origin: 530.047px 291px; transform: translateX(-6px) translateY(-9px) scale(0.52) rotate(1deg);"></circle><circle r="26" cx="530.046875" cy="291" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 530.047px 291px; transform: translateX(-21px) translateY(8px) scale(0.22) rotate(4deg);"></circle><polygon points="504.046875 345, 530.046875 293, 556.046875 345" fill="none" stroke-width="10" stroke="red" style="opacity: 0; transform-origin: 530.047px 291px; transform: translateX(-171px) translateY(-30px) scale(0.45) rotate(-11deg);"></polygon></svg><h2 class="word word--1" aria-label="thejoin"><span class="char1" aria-hidden="true" style="opacity: 0; transform: translateY(0px);">t</span><span class="char2" aria-hidden="true" style="opacity: 0; transform: translateY(0px);">h</span><span class="char3" aria-hidden="true" style="opacity: 0; transform: translateY(0px);">e</span><span class="char4" aria-hidden="true" style="opacity: 0; transform: translateY(0px);">j</span><span class="char5" aria-hidden="true" style="opacity: 0; transform: translateY(0px);">o</span><span class="char6" aria-hidden="true" style="opacity: 0; transform: translateY(0px);">i</span><span class="char7" aria-hidden="true" style="opacity: 0; transform: translateY(0px);">n</span></h2></div></div></div><section class="navigation relative"><div class="navigation-header fixed w-full"><div class="hidden md:block absolute say-hi tracking-wider"><a href="/" class="router-link-active"><img alt="Miki go to Home" src="/images/icon.png" class="mr-1 align-top inline-block w-6 m-w-full"></a><div class="hidden-tooltip inline-block"><span class="tooltip rounded shadow-lg p-1 bg-gray-600 text-grey-500 -mt-8"> Email address copied </span><a href="#">Say Hi.</a></div></div><div class="absolute hamburger cursor-pointer p-2 rounded-full"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="w-8"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg></div></div><div class="navigation-footer fixed w-full"><div class="hidden md:block absolute whoami tracking-wider"><a href="/whoami" class="">WhoAmI</a></div><div class="hidden md:block absolute writing tracking-wider"><a href="/blog" class="router-link-active">Writing</a></div></div><div class="hidden shadow md:shadow-2xl w-full md:w-1/3 h-full fixed off-canvas-menu z-10 p-5"><div class="close-header w-full border-opacity-50"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" class="inline w-12 cursor-pointer"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg><span class="text-4xl align-middle cursor-pointer">Close</span></div><div class="mb-5 md:mb-10 pb-3 md:pb-5 mobile-content absolute bottom-0 w-full text-3xl"><ul><li class="cursor-pointer pb-1"><a href="/" class="block router-link-active">~</a></li><li class="cursor-pointer py-1"><a href="/whoami" class="block">WhoAmI</a></li><li class="cursor-pointer py-1"><a href="/blog" class="block router-link-active">Writing</a></li><li class="cursor-pointer py-1 social-li"><span class="cursor-pointer">Social</span><ul class="social-box align-middle leading-none"><li class="inline-block pr-1"><a href="https://github.com/thejoin95" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="github-icon w-6"><path fill="#FFFFFF" d="M10.015,9.949c0,0-0.01,0-0.015,0H9.985c-1.191,0-2.24-0.303-2.861,0.268  c-0.371,0.342-0.527,0.754-0.527,1.197c0,1.852,1.483,2.08,3.389,2.08h0.029c1.905,0,3.389-0.229,3.389-2.08  c0-0.443-0.156-0.856-0.527-1.197C12.255,9.646,11.206,9.949,10.015,9.949z M8.393,12.48c-0.363,0-0.656-0.408-0.656-0.91  s0.293-0.908,0.656-0.908S9.05,11.068,9.05,11.57C9.051,12.072,8.757,12.48,8.393,12.48z M11.606,12.48  c-0.363,0-0.657-0.408-0.657-0.91s0.294-0.908,0.657-0.908c0.362,0,0.656,0.406,0.656,0.908  C12.263,12.072,11.969,12.48,11.606,12.48z M10,0.4c-5.302,0-9.6,4.298-9.6,9.6s4.298,9.6,9.6,9.6s9.6-4.298,9.6-9.6  S15.302,0.4,10,0.4z M10.876,13.939c-0.172,0-0.514,0-0.876,0.002c-0.362-0.002-0.704-0.002-0.876-0.002  c-0.76,0-3.772-0.059-3.772-3.689c0-0.834,0.286-1.445,0.755-1.955c-0.074-0.184-0.078-1.232,0.32-2.236c0,0,0.916,0.1,2.301,1.051  C9.017,7.029,9.509,6.988,10,6.988s0.982,0.041,1.273,0.121c1.385-0.951,2.301-1.051,2.301-1.051  c0.398,1.004,0.395,2.053,0.32,2.236c0.469,0.51,0.755,1.121,0.755,1.955C14.648,13.881,11.636,13.939,10.876,13.939z"></path></svg></a></li><li class="inline-block px-1"><a href="https://www.facebook.com/mikistorm/" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="fb-icon w-6"><path fill="#FFFFFF" d="M10,0.4c-5.302,0-9.6,4.298-9.6,9.6s4.298,9.6,9.6,9.6s9.6-4.298,9.6-9.6S15.302,0.4,10,0.4z M12.274,7.034  h-1.443c-0.171,0-0.361,0.225-0.361,0.524V8.6h1.805l-0.273,1.486H10.47v4.461H8.767v-4.461H7.222V8.6h1.545V7.726  c0-1.254,0.87-2.273,2.064-2.273h1.443V7.034z"></path></svg></a></li><li class="inline-block px-1"><a href="https://instagram.com/thejoin95" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="ig-icon w-6"><path fill="#FFFFFF" d="M13.89777,7.05115a1.65591,1.65591,0,0,0-.94891-0.94891,2.76589,2.76589,0,0,0-.92841-0.17218C11.49316,5.906,11.33508,5.90094,10,5.90094S8.50684,5.906,7.97955,5.93005a2.76589,2.76589,0,0,0-.92841.17218,1.65591,1.65591,0,0,0-.94891.94891,2.76589,2.76589,0,0,0-.17218.92841C5.906,8.50684,5.90094,8.665,5.90094,10s0.00507,1.49316.02911,2.02045a2.76553,2.76553,0,0,0,.17218.92841,1.65591,1.65591,0,0,0,.94891.94891,2.76589,2.76589,0,0,0,.92841.17218c0.52716,0.024.6853,0.02911,2.02045,0.02911s1.49329-.00507,2.02045-0.02911a2.76589,2.76589,0,0,0,.92841-0.17218,1.65591,1.65591,0,0,0,.94891-0.94891,2.76553,2.76553,0,0,0,.17218-0.92841c0.024-.52728.02911-0.68536,0.02911-2.02045S14.094,8.50684,14.06995,7.97955A2.76589,2.76589,0,0,0,13.89777,7.05115ZM10,12.56757A2.56757,2.56757,0,1,1,12.56757,10,2.56756,2.56756,0,0,1,10,12.56757ZM12.669,7.931a0.6,0.6,0,1,1,.6-0.6A0.6,0.6,0,0,1,12.669,7.931ZM11.66669,10A1.66669,1.66669,0,1,1,10,8.33331,1.66671,1.66671,0,0,1,11.66669,10ZM10,0.4A9.6,9.6,0,1,0,19.6,10,9.59995,9.59995,0,0,0,10,.4Zm4.96991,11.6615a3.67039,3.67039,0,0,1-.23242,1.21368,2.55612,2.55612,0,0,1-1.46228,1.46228,3.67039,3.67039,0,0,1-1.21368.23242C11.5282,14.99426,11.35791,15,10,15s-1.5282-.00574-2.06152-0.03009a3.67039,3.67039,0,0,1-1.21368-.23242,2.55612,2.55612,0,0,1-1.46228-1.46228,3.67039,3.67039,0,0,1-.23242-1.21368C5.00574,11.5282,5,11.35791,5,10s0.00574-1.5282.03009-2.06152a3.67039,3.67039,0,0,1,.23242-1.21368A2.55612,2.55612,0,0,1,6.72479,5.26251a3.67039,3.67039,0,0,1,1.21368-.23242C8.4718,5.00574,8.64209,5,10,5s1.5282,0.00574,2.06152.03009a3.67039,3.67039,0,0,1,1.21368.23242,2.55612,2.55612,0,0,1,1.46228,1.46228,3.67039,3.67039,0,0,1,.23242,1.21368C14.99426,8.4718,15,8.64209,15,10S14.99426,11.5282,14.96991,12.06152Z"></path></svg></a></li><li class="inline-block px-1"><a href="https://www.linkedin.com/in/miki-lombardi/" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="ld-icon w-6"><path fill="#FFFFFF" d="M10,0.4c-5.302,0-9.6,4.298-9.6,9.6s4.298,9.6,9.6,9.6s9.6-4.298,9.6-9.6S15.302,0.4,10,0.4z M7.65,13.979  H5.706V7.723H7.65V13.979z M6.666,6.955c-0.614,0-1.011-0.435-1.011-0.973c0-0.549,0.409-0.971,1.036-0.971s1.011,0.422,1.023,0.971  C7.714,6.52,7.318,6.955,6.666,6.955z M14.75,13.979h-1.944v-3.467c0-0.807-0.282-1.355-0.985-1.355  c-0.537,0-0.856,0.371-0.997,0.728c-0.052,0.127-0.065,0.307-0.065,0.486v3.607H8.814v-4.26c0-0.781-0.025-1.434-0.051-1.996h1.689  l0.089,0.869h0.039c0.256-0.408,0.883-1.01,1.932-1.01c1.279,0,2.238,0.857,2.238,2.699V13.979z"></path></svg></a></li><li class="inline-block px-1"><a href="https://medium.com/@thejoin95" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="md-icon w-6"><path fill="#FFFFFF" d="M10,0.3999634c-5.3019409,0-9.5999756,4.2980957-9.5999756,9.6000366S4.6980591,19.5999756,10,19.5999756  S19.5999756,15.3019409,19.5999756,10S15.3019409,0.3999634,10,0.3999634z M14.2000122,7.666687h-0.1165771  c0,0-0.3500977,0-0.3500977,0.3500977c0,0.3500366,0,3.9666748,0,3.9666748s0,0.3497925,0.3500977,0.3497925h0.1165771v0.9333496  h-2.7999878V12.333252h0.4666138V7.9933472h-0.0466309l-1.4301147,5.2732544H9.1304321L7.7133179,7.9933472H7.666687v4.3399048  h0.4666748v0.9333496h-2.333374V12.333252h0.1165771c0,0,0.3500977,0,0.3500977-0.3500366s0-3.9667358,0-3.9667358  s0-0.3497925-0.3500977-0.3497925H5.7999878V6.7333984H8.895874l1.0858765,4.0408325h0.0357666l1.0959473-4.0408325h3.0865479  V7.666687z"></path></svg></a></li><li class="inline-block px-1"><a href="https://twitter.com/thejoin95" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="tw-icon w-6"><path fill="#FFFFFF" d="M10,0.4c-5.302,0-9.6,4.298-9.6,9.6s4.298,9.6,9.6,9.6s9.6-4.298,9.6-9.6S15.302,0.4,10,0.4z M13.905,8.264  c0.004,0.082,0.005,0.164,0.005,0.244c0,2.5-1.901,5.381-5.379,5.381c-1.068,0-2.062-0.312-2.898-0.85  c0.147,0.018,0.298,0.025,0.451,0.025c0.886,0,1.701-0.301,2.348-0.809c-0.827-0.016-1.525-0.562-1.766-1.312  c0.115,0.021,0.233,0.033,0.355,0.033c0.172,0,0.34-0.023,0.498-0.066c-0.865-0.174-1.517-0.938-1.517-1.854V9.033  C6.257,9.174,6.549,9.26,6.859,9.27C6.351,8.93,6.018,8.352,6.018,7.695c0-0.346,0.093-0.672,0.256-0.951  c0.933,1.144,2.325,1.896,3.897,1.977c-0.033-0.139-0.049-0.283-0.049-0.432c0-1.043,0.846-1.891,1.891-1.891  c0.543,0,1.035,0.23,1.38,0.598c0.431-0.086,0.835-0.242,1.2-0.459c-0.141,0.441-0.44,0.812-0.831,1.047  c0.383-0.047,0.747-0.148,1.086-0.299C14.595,7.664,14.274,7.998,13.905,8.264z"></path></svg></a></li><li class="inline-block px-1"><a href="https://www.youtube.com/channel/UC1QLLgrGrPmlaFhS0orykCA" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 20 20" enable-background="new 0 0 20 20" xml:space="preserve" class="yt-icon w-6"><path fill="#FFFFFF" d="M11.603,9.833L9.357,8.785C9.161,8.694,9,8.796,9,9.013v1.974c0,0.217,0.161,0.319,0.357,0.228l2.245-1.048  C11.799,10.075,11.799,9.925,11.603,9.833z M10,0.4c-5.302,0-9.6,4.298-9.6,9.6s4.298,9.6,9.6,9.6s9.6-4.298,9.6-9.6  S15.302,0.4,10,0.4z M10,13.9c-4.914,0-5-0.443-5-3.9s0.086-3.9,5-3.9s5,0.443,5,3.9S14.914,13.9,10,13.9z"></path></svg></a></li></ul></li><li class="cursor-pointer pt-1"><div class="hidden-tooltip"><span class="tooltip rounded shadow-lg p-1 bg-gray-600 text-grey-500 -mt-8"> Email address copied </span> Say Hi </div></li></ul></div></div></section><section class="article container mx-auto m-width-780 p-3 py-0"><article class="article-content p-3 prose md:prose-xl"> <h1 id="raspberry-wont-boot---recover-data-and-fix-bug-with-chroot-ubuntu">Raspberry won't boot - Recover data and fix bug with chroot [ubuntu]</h1> <div class="mx-auto"> <img class="max-w-full" src="https://source.unsplash.com/53jnUK5LqEY/960x680"> </div> <p>Two weeks ago I installed on my raspberry (raspbian wheezy) upstart package (an ubuntu package for process management)... and it was an error.</p> <p>Yeah, because raspbian has systemd and you don't need to install upstart!! Don't do that! It's a little bit strange that, after installed the package, raspberry was still going.</p> <p>For an unlucky event at my house the current was gone. So, the raspberry was (suddendly) powered off. Then it won't boot anymore.</p> <p>The error show up at the boot screen was related to "semlinux" and it can't mount the partition. {% highlight bash %} Mount failed for selinuxfs on /sys/fs/selinux: No such file or directory {% endhighlight %}</p> <h2 id="how-you-can-resolve-this">How you can resolve this?</h2> <p>There were 3 choice:</p> <ul> <li>Backup or copy the whole root partition to a new sd card</li> <li>edit cmdline.txt adding init=/bin/bash (called single-user mode or recovery mode)</li> <li>fix the issue via chroot</li> </ul> <h3 id="backup">Backup</h3> <p>Yeah, I know.. we usually have a backup (don't you?)... but it was not my case! :(</p> <h3 id="single-user-mode">Single-user mode</h3> <p>So I tried to add init=/bin/bash to cmdline.txt file present in the boot partition.</p> <p>At the startup the boot stop and, after you hit enter, you can access to the root shell.</p> <p>Here you can mount all the partitions and use, almost, every command.</p> <p><code>mount -rw -o remount /</code></p> <p>After this command you can edit file and add/remove package via apt.</p> <p>Before you exit the shell, you need to <code>sync</code> all the disk.</p> <p>But, if you are an unlucky person (like me), this mode doesn't work for your issue.</p> <p>I need to remove upstart package, but in this shell I did not have a network (even via ethernet).</p> <p>So, before hard reset or copy the whole root partition to a new sd image, I decided to try with chroot command.</p> <h3 id="wtf-is-chroot">WTF is chroot?</h3> <p>It's a command that can perform a change of root directory and you can exec some command (for example a /bin/bash). So, it's like you were connect directly to raspberry via SSH.</p> <h2 id="but">BUT!</h2> <p>To this you need to have a VM or a PC with ubuntu (or other linux distro) and <code>qemu-arm</code> installed.</p> <p>qemu is a package that can simulate the raspberry's architecture (arm64).</p> <p>After installed qemu, you can mount from an img or from the sd card all the partitions.</p> <p><strong>NOTE</strong>: for creating the loopback device I usually use kpartx</p> <p>If you are using a img file: For example (this command will create, for each partition, a device called /dev/mapper/loop0pN): <code>$ sudo kpartx -a -v 2015-02-16-raspbian-wheezy.img</code></p> <p>You need to mount the root and the boot partition, together, like this:</p> <p>{% highlight bash %} $ sudo mount /dev/mapper/loop0p1 /mnt $ sudo mount /dev/mapper/loop0p1 /mnt/boot {% endhighlight %}</p> <p>Now you have your raspberry mounted. You need to connect to it! We are gonna do this using chroot command.</p> <p>Before using chroot, we need to copy our /usr/bin/qemu-arm to the mounted raspberry partition, because chroot need that for start the shell. So copy from /usr/bin/qemu-arm to /mnt/usr/bin/qemu-arm</p> <p>After that you can run: <code>sudo chroot /mnt /usr/bin/qemu-arm</code></p> <p>It will open a new root shell and that's it! Remember to sync after all the edits.</p> <p>NOTE: remember, I'm the unluckiest man in the world, and after chroot I couldn't connect to internet (if config did not working, even network config or dhcp or ethernet). So I need to mount even the proc/ directory of my ubuntu installtion to the new mounted partition of raspberry (/mnt/proc) and re-init the chroot.</p> <p>After that, I launched ifconfig and dhcpclient config and it started to working.</p> <p>It's a little bit complex here, but I hope to be of help to you!</p> </article></section></div><script src="/js/chunk-vendors.f00deeb5.js"></script><script src="/js/app.c1e52978.js"></script></body></html>